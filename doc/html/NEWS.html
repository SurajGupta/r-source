<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>R: R News</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="R.css">
</head><body>

<table width="100%" summary="page for NEWS"><tr><td>NEWS</td><td align="right">R Documentation</td></tr></table>

<h2>R News</h2>

<h3>CHANGES IN R VERSION 2.13.1</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> <code>iconv()</code> no longer translates <code>NA</code> strings as
<code>"NA"</code>.
</p>
<p>
</li>
<li><code>persp(box = TRUE)</code> now warns if the surface extends
outside the box (since occlusion for the box and axes is computed
assuming the box is a bounding box). (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=202">PR#202</a>.)
</p>
<p>
</li>
<li><code>RShowDoc()</code> can now display the licences shipped with
<font face="Courier New,Courier" color="#666666"><b>R</b></font>, e.g. <code>RShowDoc("GPL-3")</code>.
</p>
<p>
</li>
<li>New wrapper function <code>showNonASCIIfile()</code> in package
<span class="pkg">tools</span>.
</p>
<p>
</li>
<li><code>nobs()</code> now has a <code>"mle"</code> method in package
<span class="pkg">stats4</span>.
</p>
<p>
</li>
<li><code>trace()</code> now deals correctly with S4 reference classes
and corresponding reference methods (e.g., <code>$trace()</code>)
have been added.
</p>
<p>
</li>
<li><CODE>xz</CODE> has been updated to 5.0.3 (very minor bugfix
release).
</p>
<p>
</li>
<li><code>tools::compactPDF()</code> gets more compression (usually a
little, sometimes a lot) by using the compressed object streams of
PDF 1.5.
</p>
<p>
</li>
<li><code>cairo_ps(onefile = TRUE)</code> generates encapsulated EPS
on platforms with cairo &gt;= 1.6.
</p>
<p>
</li>
<li>Binary reads (e.g. by <code>readChar()</code> and <code>readBin()</code>)
are now supported on clipboard connections.  (Wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14593">PR#14593</a>.)
</p>
<p>
</li>
<li><code>as.POSIXlt.factor()</code> now passes <code>...</code> to the
character method (suggestion of Joshua Ulrich).  [Intended for <font face="Courier New,Courier" color="#666666"><b>R</b></font>
2.13.0 but accidentally removed before release.]
</p>
<p>
</li>
<li><code>vector()</code> and its wrappers such as <code>integer()</code>
and <code>double()</code> now warn if called with a <code>length</code>
argument of more than one element.  This helps track down user
errors such as calling <code>double(x)</code> instead of
<code>as.double(x)</code>.
</ul>

</p>

</p>
<p>


<h4>INSTALLATION</h4>

<p>

<ul>
<li> Building the vignette PDFs in packages <span class="pkg">grid</span> and
<span class="pkg">utils</span> is now part of running <CODE>make</CODE> from an SVN
checkout on a Unix-alike: a separate <CODE>make vignettes</CODE> step
is no longer required.
</p>
<p>
These vignettes are now made with <code>keep.source = TRUE</code> and
hence will be laid out differently.
</p>
<p>
</li>
<li><CODE>make install-strip</CODE> failed under some configuration
options.
</p>
<p>
</li>
<li>Packages can customize non-standard installation of compiled
code via a <code>src/install.libs.R</code> script. This allows packages that
have architecture-specific binaries (beyond the package's shared
objects/DLLs) to be installed in a multi-architecture setting.
</ul>

</p>

</p>
<p>


<h4>SWEAVE &amp; VIGNETTES</h4>

<p>

<ul>
<li> <code>Sweave()</code> and <code>Stangle()</code> gain an <code>encoding</code>
argument to specify the encoding of the vignette sources if the
latter do not contain a <span class="samp">\usepackage[]{inputenc}</span> statement
specifying a single input encoding.
</p>
<p>
</li>
<li>There is a new Sweave option <code>figs.only = TRUE</code> to run
each figure chunk only for each selected graphics device, and not
first using the default graphics device.   This will become the
default in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.14.0.
</p>
<p>
</li>
<li>Sweave custom graphics devices can have a custom function
<code>foo.off()</code> to shut them down.      
</p>
<p>
</li>
<li>Warnings are issued when non-portable filenames are found
for graphics files (and chunks if <code>split = TRUE</code>).  Portable
names are regarded as alphanumeric plus hyphen, underscore, plus
and hash (periods cause problems with recognizing file
extensions).
</p>
<p>
</li>
<li>The <code>Rtangle()</code> driver has a new option
<code>show.line.nos</code> which is by default false; if true it
annotates code chunks with a comment giving the line number of the
first line in the sources (the behaviour of <font face="Courier New,Courier" color="#666666"><b>R</b></font> &gt;= 2.12.0).
</p>
<p>
</li>
<li>Package installation tangles the vignette sources: this step
now converts the vignette sources from the vignette/package
encoding to the current encoding, and records the encoding (if not
ASCII) in a comment line at the top of the installed &lsquo;<span class="file">.R</span>&rsquo;
file.
</ul>

</p>

</p>
<p>


<h4>LICENCE</h4>

<p>

<ul>
<li> No parts of <font face="Courier New,Courier" color="#666666"><b>R</b></font> are now licensed solely under GPL-2.  The
licences for packages <span class="pkg">rpart</span> and <span class="pkg">survival</span> have been
changed, which means that the licence terms for <font face="Courier New,Courier" color="#666666"><b>R</b></font> as distributed
are GPL-2 | GPL-3.
</ul>

</p>

</p>
<p>


<h4>DEPRECATED AND DEFUNCT</h4>

<p>

<ul>
<li> The internal functions <code>.readRDS()</code> and
<code>.saveRDS()</code> are now deprecated in favour of the public
functions <code>readRDS()</code> and <code>saveRDS()</code> introduced in <font face="Courier New,Courier" color="#666666"><b>R</b></font>
2.13.0.
</p>
<p>
</li>
<li>Switching off lazy-loading of code <EM>via</EM> the
<span class="samp">LazyLoad</span> field of the &lsquo;<span class="file">DESCRIPTION</span>&rsquo; file is now
deprecated.  In future all packages will be lazy-loaded.
</p>
<p>
</li>
<li>The off-line <code>help()</code> types <span class="samp">"postscript"</span> and
<span class="samp">"ps"</span> are deprecated.
</ul>

</p>

</p>
<p>


<h4>UTILITIES</h4>

<p>
      
<ul>
<li> <CODE>R CMD check</CODE> on a multi-architecture installation now
skips the user's &lsquo;<span class="file">.Renviron</span>&rsquo; file for the
architecture-specific tests (which do read the 
architecture-specific &lsquo;<span class="file">Renviron.site</span>&rsquo; files).  This is
consistent with single-architecture checks, which use
<span class="option">--no-environ</span>.
</p>
<p>
</li>
<li><CODE>R CMD build</CODE> now looks for &lsquo;<span class="file">DESCRIPTION</span>&rsquo;
fields <span class="samp">BuildResaveData</span> and <span class="samp">BuildKeepEmpty</span> for
per-package overrides.  See &lsquo;Writing R Extensions&rsquo;.
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> <code>plot.lm(which = 5)</code> was intended to order factor
levels in increasing order of mean standardized residual.   It
ordered the factor labels correctly, but could plot the wrong
group of residuals against the label.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14545">PR#14545</a>)
</p>
<p>
</li>
<li><code>mosaicplot()</code> could clip the factor labels, and could
overlap them with the cells if a non-default value of
<code>cex.axis</code> was used.  (Related to <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14550">PR#14550</a>.)
</p>
<p>
</li>
<li><code>dataframe[[row,col]]</code> now dispatches on <code>[[</code>
methods for the selected column (spotted by Bill Dunlap).
</p>
<p>
</li>
<li><code>sort.int()</code> would strip the class of an object, but
leave its object bit set.  (Reported by Bill Dunlap.)      
</p>
<p>
</li>
<li><code>pbirthday()</code> and <code>qbirthday()</code> did not implement
the algorithm exactly as given in their reference and so were
unnecessarily inaccurate.
</p>
<p>
<code>pbirthday()</code> now solves the approximate formula analytically
rather than using <code>uniroot()</code> on a discontinuous function.
</p>
<p>
The description of the problem was inaccurate: the probability is
a tail probablity (&lsquo;2 <EM>or more</EM> people share a birthday&rsquo;)
</p>
<p>
</li>
<li>Complex arithmetic sometimes warned incorrectly about
producing NAs when there were NaNs in the input.
</p>
<p>
</li>
<li><code>seek(origin = "current")</code> incorrectly reported it was
not implemented for a <code>gzfile()</code> connection.
</p>
<p>
</li>
<li><code>c()</code>, <code>unlist()</code>, <code>cbind()</code> and
<code>rbind()</code> could silently overflow the maximum vector length
and cause a segfault.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14571">PR#14571</a>)
</p>
<p>
</li>
<li>The <code>fonts</code> argument to <code>X11(type = "Xlib")</code> was
being ignored.
</p>
<p>
</li>
<li>Reading (e.g. with <code>readBin()</code>) from a raw connection
was not advancing the pointer, so successive reads would read the
same value.  (Spotted by Bill Dunlap.)
</p>
<p>
</li>
<li>Parsed text containing embedded newlines was printed
incorrectly by <code>as.character.srcref()</code>.  (Reported by Hadley
Wickham.)
</p>
<p>
</li>
<li><code>decompose()</code> used with a series of a non-integer
number of periods returned a seasonal component shorter than the
original series.  (Reported by Rob Hyndman.)
</p>
<p>
</li>
<li><code>fields = list()</code> failed for <code>setRefClass()</code>.
(Reported by Michael Lawrence.)
</p>
<p>
</li>
<li>Reference classes could not redefine an inherited field
which had class <code>"ANY"</code>. (Reported by Janko Thyson.)
</p>
<p>
</li>
<li>Methods that override previously loaded versions will now
be installed and called.  (Reported by Iago Mosqueira.)
</p>
<p>
</li>
<li><code>addmargins()</code> called <code>numeric(apos)</code> rather than
<code>numeric(length(apos))</code>.
</p>
<p>
</li>
<li>The HTML help search sometimes produced bad links.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14608">PR#14608</a>)
</p>
<p>
</li>
<li>Command completion will no longer be broken if
<code>tail.default()</code> is redefined by the user. (Problem reported
by Henrik Bengtsson.)
</p>
<p>
</li>
<li>LaTeX rendering of markup in titles of help pages has been
improved; in particular, <code>\eqn{}</code> may be used there.
</p>
<p>
</li>
<li><code>isClass()</code> used its own namespace as the default of
the <code>where</code> argument inadvertently.
</p>
<p>
</li>
<li>Rd conversion to latex mis-handled multi-line titles
(including cases where there was a blank line in the <span class="samp">\title</span>
section).
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.13.0</h3>

<p>


<h4>SIGNIFICANT USER-VISIBLE CHANGES</h4>

<p>

<ul>
<li> <code>replicate()</code> (by default) and <code>vapply()</code> (always)
now return a higher-dimensional array instead of a matrix in the case
where the inner function value is an array of dimension &gt;= 2.
</p>
<p>
</li>
<li>Printing and formatting of floating point numbers is now
using the correct number of digits, where it previously rarely
differed by a few digits. (See &ldquo;scientific&rdquo; entry below.)
This affects <EM>many</EM> &lsquo;<span class="file">*.Rout.save</span>&rsquo; checks in packages.
</ul>

</p>



<h4>NEW FEATURES</h4>

<p>

<ul>
<li> <code>normalizePath()</code> has been moved to the <span class="pkg">base</span>
package (from <span class="pkg">utils</span>): this is so it can be used by
<code>library()</code> and friends.
</p>
<p>
It now does tilde expansion.
</p>
<p>
It gains new arguments <code>winslash</code> (to select the separator on
Windows) and <code>mustWork</code> to control the action if a canonical
path cannot be found.
</p>
<p>
</li>
<li>The previously barely documented limit of 256 bytes on a
symbol name has been raised to 10,000 bytes (a sanity check).
Long symbol names can sometimes occur when deparsing expressions
(for example, in <code>model.frame</code>).
</p>
<p>
</li>
<li><code>reformulate()</code> gains a <code>intercept</code> argument.
</p>
<p>
</li>
<li><code>cmdscale(add = FALSE)</code> now uses the more common
definition that there is a representation in <code>n-1</code> or less
dimensions, and only dimensions corresponding to positive
eigenvalues are used.  (Avoids confusion such as <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14397">PR#14397</a>.)
</p>
<p>
</li>
<li>Names used by <code>c()</code>, <code>unlist()</code>, <code>cbind()</code>
and <code>rbind()</code> are marked with an encoding when this can be
ascertained.
</p>
<p>
</li>
<li>R colours are now defined to refer to the sRGB color space.
</p>
<p>
The PDF, PostScript, and Quartz graphics devices record this fact.
X11 (and cairo) and Windows just assume that your screen conforms.
</p>
<p>
</li>
<li><code>system.file()</code> gains a <code>mustWork</code> argument
(suggestion of Bill Dunlap).
</p>
<p>
</li>
<li><code>new.env(hash = TRUE)</code> is now the default.
</p>
<p>
</li>
<li><code>list2env(envir = NULL)</code> defaults to hashing (with a
suitably sized environment) for lists of more than 100 elements.
</p>
<p>
</li>
<li><code>text()</code> gains a formula method.
</p>
<p>
</li>
<li><code>IQR()</code> now has a <code>type</code> argument which is passed
to <code>quantile()</code>.
</p>
<p>
</li>
<li><code>as.vector()</code>, <code>as.double()</code> etc duplicate less
when they leave the mode unchanged but remove attributes.
</p>
<p>
<code>as.vector(mode = "any")</code> no longer duplicates when it does
not remove attributes.  This helps memory usage in <code>matrix()</code>
and <code>array()</code>.
</p>
<p>
<code>matrix()</code> duplicates less if <code>data</code> is an atomic vector
with attributes such as names (but no class).
</p>
<p>
<code>dim(x) &lt;- NULL</code> duplicates less if <code>x</code> has neither
dimensions nor names (since this operation removes names and
dimnames).
</p>
<p>
</li>
<li><code>setRepositories()</code> gains an <code>addURLs</code> argument.
</p>
<p>
</li>
<li><code>chisq.test()</code> now also returns a <code>stdres</code>
component, for standardized residuals (which have unit variance,
unlike the Pearson residuals).
</p>
<p>
</li>
<li><code>write.table()</code> and friends gain a <code>fileEncoding</code>
argument, to simplify writing files for use on other OSes (e.g. a
spreadsheet intended for Windows or Mac OS X Excel).
</p>
<p>
</li>
<li>Assignment expressions of the form <code>foo::bar(x) &lt;- y</code>
and <code>foo:::bar(x) &lt;- y</code> now work; the replacement functions
used are <code>foo::`bar&lt;-`</code> and <code>foo:::`bar&lt;-`</code>.
</p>
<p>
</li>
<li><code>Sys.getenv()</code> gains a <code>names</code> argument so
<code>Sys.getenv(x, names = FALSE)</code> can replace the common idiom
of <code>as.vector(Sys.getenv())</code>.  The default has been changed
to not name a length-one result.
</p>
<p>
</li>
<li>Lazy loading of environments now preserves attributes and
locked status. (The locked status of bindings and active bindings
are still not preserved; this may be addressed in the future).
</p>
<p>
</li>
<li><code>options("install.lock")</code> may be set to <code>FALSE</code>
so that <code>install.packages()</code> defaults to <span class="option">--no-lock</span>
installs, or (on Windows) to <code>TRUE</code> so that binary installs
implement locking.
</p>
<p>
</li>
<li><code>sort(partial = p)</code> for large <code>p</code> now tries
Shellsort if quicksort is not appropriate and so works for
non-numeric atomic vectors.
</p>
<p>
</li>
<li><code>sapply()</code> gets a new option <code>simplify = "array"</code>
which returns a &ldquo;higher rank&rdquo; array instead of just a matrix
when <code>FUN()</code> returns a <code>dim()</code> length of two or more.
</p>
<p>
<code>replicate()</code> has this option set by default, and
<code>vapply()</code> now behaves that way internally.
</p>
<p>
</li>
<li><code>aperm()</code> becomes S3 generic and gets a <code>table</code>
method which preserves the class.
</p>
<p>
</li>
<li><code>merge()</code> and <code>as.hclust()</code> methods for objects of
class <code>"dendrogram"</code> are now provided.
</p>
<p>
</li>
<li>The character method of <code>as.POSIXlt()</code> now tries to
find a format that works for all non-<code>NA</code> inputs, not just
the first one.
</p>
<p>
</li>
<li><code>str()</code> now has a method for class <code>"Date"</code>
analogous to that for class <code>"POSIXt"</code>.
</p>
<p>
</li>
<li>New function <code>file.link()</code> to create hard links on
those file systems (POSIX, NTFS but not FAT) that support them.
</p>
<p>
</li>
<li>New <code>Summary()</code> group method for class <code>"ordered"</code>
implements <code>min()</code>, <code>max()</code> and <code>range()</code> for
ordered factors.
</p>
<p>
</li>
<li><code>mostattributes&lt;-()</code> now consults the <code>"dim"</code>
attribute and not the <code>dim()</code> function, making it more useful
for objects (such as data frames) from classes with methods for
<code>dim()</code>.  It also uses <code>attr&lt;-()</code> in preference to the
generics <code>name&lt;-()</code>, <code>dim&lt;-()</code> and <code>dimnames&lt;-()</code>.
(Related to <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14469">PR#14469</a>.)
</p>
<p>
</li>
<li>There is a new option <code>"browserNLdisabled"</code> to disable
the use of an empty (e.g. via the &lsquo;Return&rsquo; key) as a synonym
for <code>c</code> in <code>browser()</code> or <code>n</code> under <code>debug()</code>.
(Wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14472">PR#14472</a>.)
</p>
<p>
</li>
<li><code>example()</code> gains optional new arguments
<code>character.only</code> and <code>give.lines</code> enabling programmatic
exploration.
</p>
<p>
</li>
<li><code>serialize()</code> and <code>unserialize()</code> are no longer
described as &lsquo;experimental&rsquo;.  The interface is now regarded
as stable, although the serialization format may well change in
future releases.  (<code>serialize()</code> has a new argument
<code>version</code> which would allow the current format to be written
if that happens.)
</p>
<p>
New functions <code>saveRDS()</code> and <code>readRDS()</code> are public
versions of the &lsquo;internal&rsquo; functions <code>.saveRDS()</code> and
<code>.readRDS()</code> made available for general use.  The dot-name
versions remain available as several package authors have made use
of them, despite the documentation.  <code>readRDS()</code> no longer
wraps non-file connections in a call to <code>gzcon()</code>, for
efficiency (see its documentation).
</p>
<p>
<code>saveRDS()</code> supports <code>compress = "xz"</code>.
</p>
<p>
</li>
<li>Many functions when called with a not-open connection will
now ensure that the connection is left not-open in the event of
error.  These include <code>read.dcf()</code>, <code>dput()</code>,
<code>dump()</code>, <code>load()</code>, <code>parse()</code>, <code>readBin()</code>,
<code>readChar()</code>, <code>readLines()</code>, <code>save()</code>,
<code>writeBin()</code>, <code>writeChar()</code>, <code>writeLines()</code>,
<code>.readRDS()</code>, <code>.saveRDS()</code> and <code>tools::parse_Rd()</code>,
as well as functions calling these.
</p>
<p>
</li>
<li>Public functions <code>find.package()</code> and <code>path.package()</code>
replace the internal dot-name versions.
</p>
<p>
</li>
<li>The default method for <code>terms()</code> now looks for a
<code>"terms"</code> attribute if it does not find a <code>"terms"</code>
component, and so works for model frames.
</p>
<p>
</li>
<li><code>httpd()</code> handlers receive an additional argument
containing the full request headers as a raw vector (this can be
used to parse cookies, multi-part forms etc.). The recommended
full signature for handlers is therefore <code>function(url,
	query, body, headers, ...)</code>.
</p>
<p>
</li>
<li><code>file.edit()</code> gains a <code>fileEncoding</code> argument to
specify the encoding of the file(s).
</p>
<p>
</li>
<li>The format of the HTML package listings has changed.  If
there is more than one library tree , a table of links to
libraries is provided at the top and bottom of the page.  Where a
library contains more than 100 packages, an alphabetic index is
given at the top of the section for that library.  (As a
consequence, package names are now sorted case-insensitively
whatever the locale.)
</p>
<p>
</li>
<li><code>isSeekable()</code> now returns <code>FALSE</code> on connections
which have non-default <code>encoding</code>.  Although documented to
record if &lsquo;in principle&rsquo; the connection supports seeking,
it seems safer to report <code>FALSE</code> when it may not work.
</p>
<p>
</li>
<li><CODE>R CMD REMOVE</CODE> and <code>remove.packages()</code> now
remove file <code>R.css</code> when removing all remaining packages in a
library tree.  (Related to the wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14475">PR#14475</a>: note that this
file is no longer installed.)
</p>
<p>
</li>
<li><code>unzip()</code> now has a <code>unzip</code> argument like
<code>zip.file.extract()</code>.  This allows an external
<CODE>unzip</CODE> program to be used, which can be useful to access
features supported by Info-ZIP's <CODE>unzip</CODE> version 6 which
is now becoming more widely available.
</p>
<p>
</li>
<li>There is a simple <code>zip()</code> function, as wrapper for an
external <CODE>zip</CODE> command.
</p>
<p>
</li>
<li><code>bzfile()</code> connections can now read from concatenated
<CODE>bzip2</CODE> files (including files written with
<code>bzfile(open = "a")</code>) and files created by some other
compressors (such as the example of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14479">PR#14479</a>).
</p>
<p>
</li>
<li>The primitive function <code>c()</code> is now of type BUILTIN.
</p>
<p>
</li>
<li><code>plot(&lt;dendrogram&gt;, .., nodePar=*)</code> now obeys an optional
<code>xpd</code> specification (allowing clipping to be turned off
completely).
</p>
<p>
</li>
<li><code>nls(algorithm="port")</code> now shares more code with
<code>nlminb()</code>, and is more consistent with the other
<code>nls()</code> algorithms in its return value.
</p>
<p>
</li>
<li><CODE>xz</CODE> has been updated to 5.0.1 (very minor bugfix
release).
</p>
<p>
</li>
<li><code>image()</code> has gained a logical <code>useRaster</code>
argument allowing it to use a bitmap raster for plotting a
regular grid instead of polygons. This can be more efficient, but
may not be supported by all devices. The default is <code>FALSE</code>.
</p>
<p>
</li>
<li><code>list.files()</code>/<code>dir()</code> gains a new argument
<code>include.dirs()</code> to include directories in the listing when
<code>recursive = TRUE</code>.
</p>
<p>
</li>
<li>New function <code>list.dirs()</code> lists all directories,
(even empty ones).
</p>
<p>
</li>
<li><code>file.copy()</code> now (by default) copies
read/write/execute permissions on files, moderated by the current
setting of <code>Sys.umask()</code>.
</p>
<p>
</li>
<li><code>Sys.umask()</code> now accepts <code>mode = NA</code> and returns
the current <code>umask</code> value (visibly) without changing it.
</p>
<p>
</li>
<li>There is a <code>!</code> method for classes <code>"octmode"</code> and
<code>"hexmode"</code>: this allows <code>xor(a, b)</code> to work if both
<code>a</code> and <code>b</code> are from one of those classes.
</p>
<p>
</li>
<li><code>as.raster()</code> no longer fails for vectors or matrices
containing <code>NA</code>s.
</p>
<p>
</li>
<li>New hook <code>"before.new.plot"</code> allows functions to be run
just before advancing the frame in <code>plot.new</code>, which is
potentially useful for custom figure layout implementations.
</p>
<p>
</li>
<li>Package <span class="pkg">tools</span> has a new function <code>compactPDF()</code>
to try to reduce the size of PDF files <EM>via</EM> <CODE>qpdf</CODE>
or <CODE>gs</CODE>.
</p>
<p>
</li>
<li><code>tar()</code> has a new argument <code>extra_flags</code>.
</p>
<p>
</li>
<li><code>dotchart()</code> accepts more general objects <code>x</code> such
as 1D tables which can be coerced by <code>as.numeric()</code> to a
numeric vector, with a warning since that might not be
appropriate.
</p>
<p>
</li>
<li>The previously internal function <code>create.post()</code> is now
exported from <span class="pkg">utils</span>, and the documentation for
<code>bug.report()</code> and <code>help.request()</code> now refer to that
for <code>create.post()</code>.
</p>
<p>
It has a new <code>method = "mailto"</code> on Unix-alikes similar to
that on Windows: it invokes a default mailer via <CODE>open</CODE>
(Mac OS X) or <code>xdg-open</code> or the default browser (elsewhere).
</p>
<p>
The default for <code>ccaddress</code> is now
<code>getOption("ccaddress")</code> which is by default unset: using the
username as a mailing address nowadays rarely works as expected.
</p>
<p>
</li>
<li>The default for <code>options("mailer")</code> is now
<code>"mailto"</code> on all platforms.
</p>
<p>
</li>
<li><code>unlink()</code> now does tilde-expansion (like most other
file functions).
</p>
<p>
</li>
<li><code>file.rename()</code> now allows vector arguments (of the
same length).
</p>
<p>
</li>
<li>The <code>"glm"</code> method for <code>logLik()</code> now returns an
<code>"nobs"</code> attribute (which <code>stats4::BIC()</code> assumed it
did).
</p>
<p>
The <code>"nls"</code> method for <code>logLik()</code> gave incorrect results
for zero weights.
</p>
<p>
</li>
<li>There is a new generic function <code>nobs()</code> in package
<span class="pkg">stats</span>, to extract from model objects a suitable value for
use in BIC calculations.  An S4 generic derived from it is defined
in package <span class="pkg">stats4</span>.
</p>
<p>
</li>
<li>Code for S4 reference-class methods is now examined for
possible errors in non-local assignments.
</p>
<p>
</li>
<li><code>findClasses</code>, <code>getGeneric</code>, <code>findMethods</code>
and <code>hasMethods</code> are revised to deal consistently with
the <code>package=</code> argument and be consistent with soft name space
policy for finding objects.
</p>
<p>
</li>
<li><code>tools::Rdiff()</code> now has the option to return not only
the status but a character vector of observed differences (which
are still by default sent to &lsquo;<span class="file">stdout</span>&rsquo;).
</p>
<p>
</li>
<li>The startup environment variables <span class="env">R_ENVIRON_USER</span>,
<span class="env">R_ENVIRON</span>, <span class="env">R_PROFILE_USER</span> and <span class="env">R_PROFILE</span> are now
treated more consistently.  In all cases an empty value is
considered to be set and will stop the default being used, and for
the last two tilde expansion is performed on the file name.  (Note
that setting an empty value is probably impossible on Windows.)
</p>
<p>
</li>
<li>Using <CODE>R --no-environ CMD</CODE>, <CODE>R
	--no-site-file CMD</CODE> or <CODE>R --no-init-file CMD</CODE> sets
environment variables so these settings are passed on to child <font face="Courier New,Courier" color="#666666"><b>R</b></font>
processes, notably those run by <code>INSTALL</code>, <code>check</code> and
<code>build</code>. <CODE>R --vanilla CMD</CODE> sets these three options
(but not <span class="option">--no-restore</span>).
</p>
<p>
</li>
<li><code>smooth.spline()</code> is somewhat faster.  With
<code>cv=NA</code> it allows some leverage computations to be skipped,
</p>
<p>
</li>
<li>The internal (C) function <span class="samp">scientific()</span>, at the heart
of <font face="Courier New,Courier" color="#666666"><b>R</b></font>'s <code>format.info(x)</code>, <code>format(x)</code>, <code>print(x)</code>,
etc, for numeric <code>x</code>, has been re-written in order to provide
slightly more correct results, fixing <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14491">PR#14491</a>, notably in
border cases including when <code>digits &gt;= 16</code>, thanks to
substantial contributions (code and experiments) from Petr
Savicky.  This affects a noticable amount of numeric output from
<font face="Courier New,Courier" color="#666666"><b>R</b></font>.
</p>
<p>
</li>
<li>A new function <code>grepRaw()</code> has been introduced for
finding subsets of raw vectors. It supports both literal searches
and regular expressions.
</p>
<p>
</li>
<li>Package <span class="pkg">compiler</span> is now provided as a standard
package.  See <code>?compiler::compile</code> for information on how to
use the compiler.  This package implements a byte code compiler
for <font face="Courier New,Courier" color="#666666"><b>R</b></font>: by default the compiler is not used in this release.  See
the &lsquo;R Installation and Administration Manual&rsquo; for how to
compile the base and recommended packages.
</p>
<p>
</li>
<li>Providing an <code>exportPattern</code> directive in a NAMESPACE
file now causes classes to be exported according to the same
pattern, for example the default from <code>package.skeleton()</code>
to specify all names starting with a letter.  An explicit
directive to <code>exportClassPattern</code> will still over-ride.
</p>
<p>
</li>
<li>There is an additional marked encoding <code>"bytes"</code> for
character strings.  This is intended to be used for non-ASCII
strings which should be treated as a set of bytes, and never
re-encoded as if they were in the encoding of the currrent locale:
<code>useBytes = TRUE</code> is autmatically selected in functions such
as <code>writeBin()</code>, <code>writeLines()</code>, <code>grep()</code> and
<code>strsplit()</code>.
</p>
<p>
Only a few character operations are supported (such as <code>substr()</code>).
</p>
<p>
Printing, <code>format()</code> and <code>cat()</code> will represent non-ASCII
bytes in such strings by a <span class="samp">\xab</span> escape.
</p>
<p>
</li>
<li>The new function <code>removeSource()</code> removes the internally
stored source from a function.
</p>
<p>
</li>
<li><code>"srcref"</code> attributes now include two additional
line number values, recording the line numbers in the order they
were parsed.
</p>
<p>
</li>
<li>New functions have been added for source reference access:
<code>getSrcFilename()</code>, <code>getSrcDirectory()</code>,
<code>getSrcLocation()</code> and <code>getSrcref()</code>.
</p>
<p>
</li>
<li><code>Sys.chmod()</code> has an extra argument <code>use_umask</code>
which defaults to true and restricts the file mode by the current
setting of <code>umask</code>.  This means that all the <font face="Courier New,Courier" color="#666666"><b>R</b></font> functions
which manipulate file/directory permissions by default respect
<code>umask</code>, notably <CODE>R CMD INSTALL</CODE>.
</p>
<p>
</li>
<li><code>tempfile()</code> has an extra argument <code>fileext</code> to
create a temporary filename with a specified extension.
(Suggestion and initial implementation by Dirk Eddelbuettel.)
</p>
<p>
There are improvements in the way <code>Sweave()</code> and
<code>Stangle()</code> handle non-ASCII vignette sources, especially in
a UTF-8 locale: see &lsquo;Writing R Extensions&rsquo; which now has a
subsection on this topic.
</p>
<p>
</li>
<li><code>factanal()</code> now returns the rotation matrix if a
rotation such as <code>"promax"</code> is used, and hence factor
correlations are displayed.  (Wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=12754">PR#12754</a>.)
</p>
<p>
</li>
<li>The <code>gctorture2()</code> function provides a more refined
interface to the GC torture process.  Environment variables
<span class="env">R_GCTORTURE</span>, <span class="env">R_GCTORTURE_WAIT</span>, and
<span class="env">R_GCTORTURE_INHIBIT_RELEASE</span> can also be used to control the
GC torture process.
</p>
<p>
</li>
<li><code>file.copy(from, to)</code> no longer regards it as an error
to supply a zero-length <code>from</code>: it now simply does nothing.
</p>
<p>
</li>
<li><code>rstandard.glm()</code> gains a <code>type</code> argument which can
be used to request standardized Pearson residuals.
</p>
<p>
</li>
<li>A start on a Turkish translation, thanks to Murat Alkan.
</p>
<p>
</li>
<li><code>.libPaths()</code> calls <code>normalizePath(winslash = "/")</code>
on the paths: this helps (usually) to present them in a
user-friendly form and should detect duplicate paths accessed via
different symbolic links.
</p>
<p>
</li>
<li><code>download.file()</code> can be now used with external methods
even if there are spaces in the URL or the target filename.
</ul>

</p>

</p>
<p>


<h4>SWEAVE CHANGES</h4>

<p>

<ul>
<li> <code>Sweave()</code> has options to produce PNG and JPEG figures,
and to use a custom function to open a graphics device (see
<code>?RweaveLatex</code>).<br>
(Based in part on the contribution of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14418">PR#14418</a>.)
</p>
<p>
</li>
<li>The default for <code>Sweave()</code> is to produce only PDF
figures (rather than both EPS and PDF).
</p>
<p>
</li>
<li>Environment variable <span class="env">SWEAVE_OPTIONS</span> can be used to
supply defaults for existing or new options to be applied after
the Sweave driver setup has been run.
</p>
<p>
</li>
<li>The Sweave manual is now included as a vignette in the
<span class="pkg">utils</span> package.
</p>
<p>
</li>
<li><code>Sweave()</code> handles <code>keep.source=TRUE</code> much better:
it could duplicate some lines and omit comments. (Reported by John
Maindonald and others.)
</ul>

</p>

</p>
<p>


<h4>C-LEVEL FACILITIES</h4>

<p>

<ul>
<li> Because they use a C99 interface which a C++ compiler is not
required to support, <code>Rvprintf</code> and <code>REvprintf</code> are only
defined by &lsquo;<span class="file">R_ext/Print.h</span>&rsquo; in C++ code if the macro
<code>R_USE_C99_IN_CXX</code> is defined when it is included.
</p>
<p>
</li>
<li><code>pythag</code> duplicated the C99 function <code>hypot</code>.  It
is no longer provided, but is used as a substitute for <code>hypot</code>
in the very unlikely event that the latter is not available.
</p>
<p>
</li>
<li><code>R_inspect(obj)</code> and <code>R_inspect3(obj, deep, pvec)</code>
are (hidden) C-level entry points to the internal <code>inspect</code>
function and can be used for C-level debugging (e.g., in conjunction
with the <code>p</code> command in <code>gdb</code>).
</p>
<p>
</li>
<li>Compiling R with <span class="option">--enable-strict-barrier</span> now also
enables additional checking for use of unprotected objects. In
combination with <code>gctorture()</code> or <code>gctorture2()</code> and a
C-level debugger this can be useful for tracking down memory
protection issues.
</ul>

</p>

</p>
<p>


<h4>UTILITIES</h4>

<p>

<ul>
<li> <CODE>R CMD Rdiff</CODE> is now implemented in <font face="Courier New,Courier" color="#666666"><b>R</b></font> on
Unix-alikes (as it has been on Windows since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.12.0).
</p>
<p>
</li>
<li><CODE>R CMD build</CODE> no longer does any cleaning in the
supplied package directory: all the cleaning is done in the copy.
</p>
<p>
It has a new option <span class="option">--install-args</span> to pass arguments to
<CODE>R CMD INSTALL</CODE> for <span class="option">--build</span> (but not when
installing to rebuild vignettes).
</p>
<p>
There is new option, <span class="option">--resave-data</span>, to call
<code>tools::resaveRdaFiles()</code> on the &lsquo;<span class="file">data</span>&rsquo; directory, to
compress tabular files (&lsquo;<span class="file">.tab</span>&rsquo;, &lsquo;<span class="file">.csv</span>&rsquo; etc) and to
convert &lsquo;<span class="file">.R</span>&rsquo; files to &lsquo;<span class="file">.rda</span>&rsquo; files.  The default,
<span class="option">--resave-data=gzip</span>, is to do so in a way compatible even
with years-old versions of <font face="Courier New,Courier" color="#666666"><b>R</b></font>, but better compression is given by
<span class="option">--resave-data=best</span>, requiring <font face="Courier New,Courier" color="#666666"><b>R</b></font> &gt;= 2.10.0.
</p>
<p>
It now adds a &lsquo;<span class="file">datalist</span>&rsquo; file for &lsquo;<span class="file">data</span>&rsquo; directories of
more than 1Mb.
</p>
<p>
Patterns in &lsquo;<span class="file">.Rbuildignore</span>&rsquo; are now also matched against all
directory names (including those of empty directories).
</p>
<p>
There is a new option, <span class="option">--compact-vignettes</span>, to try
reducing the size of PDF files in the &lsquo;<span class="file">inst/doc</span>&rsquo; directory.
Currently this tries <CODE>qpdf</CODE>: other options may be used in
future.
</p>
<p>
When re-building vignettes and a &lsquo;<span class="file">inst/doc/Makefile</span>&rsquo; file is
found, <code>make clean</code> is run if the makefile has a
<code>clean:</code> target.
</p>
<p>
After re-building vignettes the default clean-up operation will
remove any directories (and not just files) created during the
process: e.g. one package created a &lsquo;<span class="file">.R_cache</span>&rsquo; directory.
</p>
<p>
Empty directories are now removed unless the option
<span class="option">--keep-empty-dirs</span> is given (and a few packages do
deliberately include empty directories).
</p>
<p>
If there is a field <code>BuildVignettes</code> in the package
&lsquo;<span class="file">DESCRIPTION</span>&rsquo; file with a false value, re-building the
vignettes is skipped.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now also checks for filenames that are
case-insensitive matches to Windows' reserved file names with
extensions, such as &lsquo;<span class="file">nul.Rd</span>&rsquo;, as these have caused problems
on some Windows systems.
</p>
<p>
It checks for inefficiently saved &lsquo;<span class="file">data/*.rda</span>&rsquo; and
&lsquo;<span class="file">data/*.RData</span>&rsquo; files, and reports on those large than 100Kb.
A more complete check (including of the type of compression, but
potentially much slower) can be switched on by setting environment
variable <span class="env">_R_CHECK_COMPACT_DATA2_</span> to <span class="samp">TRUE</span>.
</p>
<p>
The types of files in the <code>data</code> directory are now checked,
as packages are <EM>still</EM> misusing it for non-<font face="Courier New,Courier" color="#666666"><b>R</b></font> data files.
</p>
<p>
It now extracts and runs the <font face="Courier New,Courier" color="#666666"><b>R</b></font> code for each vignette in a
separate directory and <font face="Courier New,Courier" color="#666666"><b>R</b></font> process: this is done in the package's
declared encoding.  Rather than call
<code>tools::checkVignettes()</code>, it calls
<code>tool::buildVignettes()</code> to see if the vignettes can be
re-built as they would be by <CODE>R CMD build</CODE>.  Option
<span class="option">--use-valgrind</span> now applies only to these runs, and not
when running code to rebuild the vignettes.  This version does a
much better job of suppressing output from successful vignette
tests.
</p>
<p>
The &lsquo;<span class="file">00check.log</span>&rsquo; file is a more complete record of what is
output to &lsquo;<span class="file">stdout</span>&rsquo;: in particular contains more details of
the tests.
</p>
<p>
It now check all syntactically valid Rd usage entries, and warns
about assignments (unless these give the usage of replacement
functions).
</p>
<p>
&lsquo;<span class="file">.tar.xz</span>&rsquo; compressed tarballs are now allowed, if
<CODE>tar</CODE> supports them (and setting environment variable
<span class="env">TAR</span> to <span class="samp">internal</span> ensures so on all platforms).
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now warns if it finds
&lsquo;<span class="file">inst/doc/makefile</span>&rsquo;, and <CODE>R CMD build</CODE> renames such a
file to &lsquo;<span class="file">inst/doc/Makefile</span>&rsquo;.
</ul>

</p>

</p>
<p>


<h4>INSTALLATION</h4>

<p>

<ul>
<li> Installing <font face="Courier New,Courier" color="#666666"><b>R</b></font> no longer tries to find <CODE>perl</CODE>, and
<CODE>R CMD</CODE> no longer tries to substitute a full path for
<CODE>awk</CODE> nor <CODE>perl</CODE> &ndash; this was a legacy from the
days when they were used by <font face="Courier New,Courier" color="#666666"><b>R</b></font> itself.  Because a couple of
packages do use <CODE>awk</CODE>, it is set as the <CODE>make</CODE>
(rather than environment) variable <span class="env">AWK</span>.
</p>
<p>
</li>
<li><CODE>make check</CODE> will now fail if there are differences
from the reference output when testing package examples and if
environment variable <span class="env">R_STRICT_PACKAGE_CHECK</span> is set to a true
value.
</p>
<p>
</li>
<li>The C99 double complex type is now required.
</p>
<p>
The C99 complex trigonometric functions (such as <span class="samp">csin</span>) are
not currently required (FreeBSD lacks most of them): substitutes
are used if they are missing.
</p>
<p>
</li>
<li>The C99 system call <span class="samp">va_copy</span> is now required.
</p>
<p>
</li>
<li>If environment variable <span class="env">R_LD_LIBRARY_PATH</span> is set
during configuration (for example in &lsquo;<span class="file">config.site</span>&rsquo;) it is
used unchanged in file &lsquo;<span class="file">etc/ldpaths</span>&rsquo; rather than being
appended to.
</p>
<p>
</li>
<li><CODE>configure</CODE> looks for support for OpenMP and if
found compiles <font face="Courier New,Courier" color="#666666"><b>R</b></font> with appropriate flags and also makes them
available for use in packages: see &lsquo;Writing R Extensions&rsquo;.
</p>
<p>
This is currently experimental, and is only used in <font face="Courier New,Courier" color="#666666"><b>R</b></font> with a
single thread for <code>colSums()</code> and <code>colMeans()</code>.  Expect
it to be more widely used in later versions of <font face="Courier New,Courier" color="#666666"><b>R</b></font>.
</p>
<p>
This can be disabled by the <span class="option">--disable-openmp</span> flag.
</ul>

</p>

</p>
<p>


<h4>PACKAGE INSTALLATION</h4>

<p>

<ul>
<li> <CODE>R CMD INSTALL --clean</CODE> now removes copies of a
&lsquo;<span class="file">src</span>&rsquo; directory which are created when multiple
sub-architectures are in use.  (Following a comment from
Berwin Turlach.)
</p>
<p>
</li>
<li>File &lsquo;<span class="file">R.css</span>&rsquo; is now installed on a per-package basis
(in the package's &lsquo;<span class="file">html</span>&rsquo; directory) rather than in each
library tree, and this is used for all the HTML pages in the
package.  This helps when installing packages with static HTML
pages for use on a webserver.  It will also allow future versions
of <font face="Courier New,Courier" color="#666666"><b>R</b></font> to use different stylesheets for the packages they install.
</p>
<p>
</li>
<li>A top-level file &lsquo;<span class="file">.Rinstignore</span>&rsquo; in the package sources
can list (in the same way as &lsquo;<span class="file">.Rbuildignore</span>&rsquo;) files under
<code>inst</code> that should not be installed.  (Why should there be any
such files?  Because all the files needed to re-build vignettes
need to be under <code>inst/doc</code>, but they may not need to be
installed.)
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> has a new option
<span class="option">--compact-docs</span> to compact any PDFs under the
&lsquo;<span class="file">inst/doc</span>&rsquo; directory.  Currently this uses <CODE>qpdf</CODE>,
which must be installed (see &lsquo;Writing R Extensions&rsquo;).
</p>
<p>
</li>
<li>There is a new option <span class="option">--lock</span> which can be used to
cancel the effect of <span class="option">--no-lock</span> or <span class="option">--pkglock</span> earlier
on the command line.
</p>
<p>
</li>
<li>Option <span class="option">--pkglock</span> can now be used with more than one
package, and is now the default if only one package is specified.
</p>
<p>
</li>
<li>Argument <code>lock</code> of <code>install.packages()</code> can now be
use for Mac binary installs as well as for Windows ones.  The
value <code>"pkglock"</code> is now accepted, as well as <code>TRUE</code> and
<code>FALSE</code> (the default).
</p>
<p>
</li>
<li>There is a new option <span class="option">--no-clean-on-error</span> for
<CODE>R CMD INSTALL</CODE> to retain a partially installed package for
forensic analysis.
</p>
<p>
</li>
<li>Packages with names ending in &lsquo;<span class="file">.</span>&rsquo; are not portable
since Windows does not work correctly with such directory names.
This is now warned about in <CODE>R CMD check</CODE>, and will not be
allowed in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.14.x.
</p>
<p>
</li>
<li>The vignette indices are more comprehensive (in the style of
<code>browseVignetttes()</code>).
</ul>

</p>

</p>
<p>


<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> <code>require(save = TRUE)</code> is defunct, and use of the
<code>save</code> argument is deprecated.
</p>
<p>
</li>
<li><CODE>R CMD check --no-latex</CODE> is defunct: use
<span class="option">--no-manual</span> instead.
</p>
<p>
</li>
<li><CODE>R CMD Sd2Rd</CODE> is defunct.
</p>
<p>
</li>
<li>The <code>gamma</code> argument to <code>hsv()</code>,
<code>rainbow()</code>, and <code>rgb2hsv()</code> is deprecated
and no longer has any effect.
</p>
<p>
</li>
<li>The previous options for <CODE>R CMD build --binary</CODE>
(<span class="option">--auto-zip</span>, <span class="option">--use-zip-data</span> and
<span class="option">--no-docs</span>) are deprecated (or defunct):
use the new option <span class="option">--install-args</span> instead.
</p>
<p>
</li>
<li>When a character value is used for the <code>EXPR</code>
argument in <code>switch()</code>, only a single unnamed alternative
value is now allowed.
</p>
<p>
</li>
<li>The wrapper <code>utils::link.html.help()</code> is no longer
available.
</p>
<p>
</li>
<li>Zip-ing data sets in packages (and hence <CODE>R CMD
	INSTALL</CODE> options <span class="option">--use-zip-data</span> and <span class="option">--auto-zip</span>, as
well as the <span class="samp">ZipData: yes</span> field in a <code>DESCRIPTION</code> file)
is defunct.
</p>
<p>
Installed packages with zip-ed data sets can still be used, but a
warning that they should be re-installed will be given.
</p>
<p>
</li>
<li>The &lsquo;experimental&rsquo; alternative specification of a
name space via <code>.Export()</code> etc is now defunct.
</p>
<p>
</li>
<li>The option <span class="option">--unsafe</span> to <CODE>R CMD INSTALL</CODE> is
deprecated: use the identical option <span class="option">--no-lock</span> instead.
</p>
<p>
</li>
<li>The entry point <code>pythag</code> in &lsquo;<span class="file">Rmath.h</span>&rsquo; is deprecated
in favour of the C99 function <code>hypot</code>.  A wrapper for
<code>hypot</code> is provided for <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.13.x only.
</p>
<p>
</li>
<li>Direct access to the <code>"source"</code> attribute of functions
is deprecated; use <code>deparse(fn, control="useSource")</code> to access
it, and <code>removeSource(fn)</code> to remove it.
</p>
<p>
</li>
<li><CODE>R CMD build --binary</CODE> is now formally deprecated:
<CODE>R CMD INSTALL --build</CODE> has long been the preferred
alternative.
</p>
<p>
</li>
<li>Single-character package names are deprecated (and <span class="pkg">R</span>
is already disallowed to avoid confusion in <span class="samp">Depends:</span>
fields).
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> <code>drop.terms</code> and the <code>[</code> method for class
<code>"terms"</code> no longer add back an intercept.  (Reported by
Niels Hansen.)
</p>
<p>
</li>
<li><code>aggregate</code> preserves the class of a column (e.g. a
date) under some circumstances where it discarded the class
previously.
</p>
<p>
</li>
<li><code>p.adjust()</code> now always returns a vector result, as
documented.  In previous versions it copied attributes (such as
dimensions) from the <code>p</code> argument: now it only copies names.
</p>
<p>
</li>
<li>On PDF and PostScript devices, a line width of zero was
recorded verbatim and this caused problems for some viewers
(a very thin line combined with a non-solid line dash pattern
could also cause a problem).  On these devices, the line width is
now limited at 0.01 and for very thin lines with complex dash
patterns the device may force the line dash pattern to be solid.
(Reported by Jari Oksanen.)
</p>
<p>
</li>
<li>The <code>str()</code> method for class <code>"POSIXt"</code> now gives
sensible output for 0-length input.
</p>
<p>
</li>
<li>The one- and two-argument complex maths functions failed to
warn if NAs were generated (as their numeric analogues do).
</p>
<p>
</li>
<li>Added <code>.requireCachedGenerics</code> to the <code>dont.mind</code>
list for <code>library()</code> to avoid warnings about duplicates.
</p>
<p>
</li>
<li><code>$&lt;-.data.frame</code> messed with the class attribute,
breaking any S4 subclass.  The S4 <code>data.frame</code> class now has its own
<code>$&lt;-</code> method, and turns dispatch on for this primitive.
</p>
<p>
</li>
<li><code>Map()</code> did not look up a character argument <code>f</code>
in the correct frame, thanks to lazy evaluation.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14495">PR#14495</a>)
</p>
<p>
</li>
<li><code>file.copy()</code> did not tilde-expand <code>from</code> and <code>to</code>
when <code>to</code> was a directory.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14507">PR#14507</a>)
</p>
<p>
</li>
<li>It was possible (but very rare) for the loading test in
<CODE>R CMD INSTALL</CODE> to crash a child <font face="Courier New,Courier" color="#666666"><b>R</b></font> process and so leave
around a lock directory and a partially installed package.  That
test is now done in a separate process.
</p>
<p>
</li>
<li><code>plot(&lt;formula&gt;, data=&lt;matrix&gt;,..)</code> now works in more
cases; similarly for <code>points()</code>, <code>lines()</code> and
<code>text()</code>.
</p>
<p>
</li>
<li><code>edit.default()</code> contained a manual dispatch for matrices
(the <code>"matrix"</code> class didn't really exist when it was written).
This caused an infinite recursion in the no-GUI case and has now
been removed.
</p>
<p>
</li>
<li><code>data.frame(check.rows = TRUE)</code> sometimes worked when
it should have detected an error.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14530">PR#14530</a>)
</p>
<p>
</li>
<li><code>scan(sep= , strip.white=TRUE)</code> sometimes stripped
trailing spaces from within quoted strings.  (The real bug in
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14522">PR#14522</a>.)
</p>
<p>
</li>
<li>The rank-correlation methods for <code>cor()</code> and
<code>cov()</code> with <code>use = "complete.obs"</code> computed the ranks
before removing missing values, whereas the documentation implied
incomplete cases were removed first.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14488">PR#14488</a>)
</p>
<p>
They also failed for 1-row matrices.
</p>
<p>
</li>
<li>The perpendicular adjustment used in placing text and
expressions in the margins of plots was not scaled by
<code>par("mex")</code>. (Part of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14532">PR#14532</a>.)
</p>
<p>
</li>
<li>Quartz Cocoa device now catches any Cocoa exceptions that
occur during the creation of the device window to prevent crashes.
It also imposes a limit of 144 ft^2 on the area used by a window
to catch user errors (unit misinterpretation) early.
</p>
<p>
</li>
<li>The browser (invoked by <code>debug()</code>, <code>browser()</code>
or otherwise) would display attributes such as <code>"wholeSrcref"</code>
that were intended for internal use only.
</p>
<p>
</li>
<li>R's internal filename completion now properly handles
filenames with spaces in them even when the readline library is
used.  This resolves <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14452">PR#14452</a> provided the internal filename
completion is used (e.g., by setting <code>rc.settings(files =
	TRUE)</code>).
</p>
<p>
</li>
<li>Inside <code>uniroot(f, ...)</code>, <code>-Inf</code> function values
are now replaced by a maximally <B>negative</B> value.
</p>
<p>
</li>
<li><code>rowsum()</code> could silently over/underflow on integer
inputs (reported by Bill Dunlap).
</p>
<p>
</li>
<li><code>as.matrix()</code> did not handle <code>"dist"</code> objects with
zero rows.
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.12.2 patched</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> <code>max()</code> and <code>min()</code> work harder to ensure that
<code>NA</code> has precedence over <code>NaN</code>, so e.g. <code>min(NaN,
	NA)</code> is <code>NA</code>.  (This was not previously documented except
for within a single numeric vector, where compiler optimizations
often defeated the code.)
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> A change to the C function <span class="samp">R_tryEval</span> had broken error
messages in S4 method selection; the error message is now printed.
</p>
<p>
</li>
<li>PDF output with a non-RGB color model used RGB for the line
stroke color.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14511">PR#14511</a>)
</p>
<p>
</li>
<li><code>stats4::BIC()</code> assumed without checking that an object
of class <code>"logLik"</code> has an <code>"nobs"</code> attribute:
<code>glm()</code> fits did not and so <code>BIC()</code> failed for them.
</p>
<p>
</li>
<li>In some circumstances a one-sided <code>mantelhaen.test()</code>
reported the p-value for the wrong tail.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14514">PR#14514</a>)
</p>
<p>
</li>
<li>Passing the invalid value <code>lty = NULL</code> to <code>axis()</code>
sent an invalid value to the graphics device, and might cause the
device to segfault.
</p>
<p>
</li>
<li><code>Sweave()</code> with <code>concordance=TRUE</code> could lead to
invalid PDF files; &lsquo;<span class="file">Sweave.sty</span>&rsquo; has been updated to avoid
this.
</p>
<p>
</li>
<li>Non-ASCII characters in the titles of help pages were
not rendered properly in some locales, and could cause errors
or warnings.
</p>
<p>
</li>
<li><code>checkRd()</code> gave a spurious error if the <code>\href</code>
macro was used.
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.12.2</h3>

<p>


<h4>SIGNIFICANT USER-VISIBLE CHANGES</h4>

<p>

<ul>
<li> Complex arithmetic (notably <code>z^n</code> for complex <code>z</code>
and integer <code>n</code>) gave incorrect results since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.10.0 on
platforms without C99 complex support.  This and some
lesser issues in trignometric functions have been corrected.
</p>
<p>
Such platforms were rare (we know of Cygwin and FreeBSD).
However, because of new compiler optimizations in the way complex
arguments are handled, the same code was selected on x86_64 Linux
with <CODE>gcc 4.5.x</CODE> at the default <code>-O2</code> optimization
(but not at <code>-O</code>).
</p>
<p>
</li>
<li>There is a workaround for crashes seen with several packages
on systems using <span class="samp">zlib 1.2.5</span>: see the INSTALLATION section.
</ul>

</p>

</p>
<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> PCRE has been updated to 8.12 (two bug-fix releases since 8.10).
</p>
<p>
</li>
<li><code>rep()</code>, <code>seq()</code>, <code>seq.int()</code> and
<code>seq_len()</code> report more often when the first element is taken
of an argument of incorrect length.
</p>
<p>
</li>
<li>The Cocoa back-end for the <code>quartz()</code> graphics device
on Mac OS X provides a way to disable event loop processing
temporarily (useful, e.g., for forked instances of <font face="Courier New,Courier" color="#666666"><b>R</b></font>).
</p>
<p>
</li>
<li><code>kernel()</code>'s default for <code>m</code> was not appropriate
if <code>coef</code> was a set of coefficients.  (Reported by Pierre
Chausse.)
</p>
<p>
</li>
<li><code>bug.report()</code> has been updated for the current <font face="Courier New,Courier" color="#666666"><b>R</b></font> bug
tracker, which does not accept emailed submissions.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now checks for the correct use of
<span class="samp">$(LAPACK_LIBS)</span> (as well as <span class="samp">$(BLAS_LIBS)</span>), since
several CRAN recent submissions have ignored &lsquo;Writing R
Extensions&rsquo;.
</ul>

</p>

</p>
<p>


<h4>INSTALLATION</h4>

<p>

<ul>
<li> The <span class="samp">zlib</span> sources in the distribution are now built
with all symbols remapped: this is intended to avoid problems seen
with packages such as <span class="pkg">XML</span> and <span class="pkg">rggobi</span> which link to
&lsquo;<span class="file">zlib.so.1</span>&rsquo; on systems using <span class="samp">zlib 1.2.5</span>.
</p>
<p>
</li>
<li>The default for <span class="env">FFLAGS</span> and <span class="env">FCFLAGS</span> with
<CODE>gfortran</CODE> on x86_64 Linux has been changed back to <span class="samp">-g
	-O2</span>:  however, setting <span class="samp">-g -O</span> may still be needed for
<CODE>gfortran 4.3.x</CODE>.
</ul>

</p>

</p>
<p>


<h4>PACKAGE INSTALLATION</h4>

<p>

<ul>
<li> A <span class="samp">LazyDataCompression</span> field in the &lsquo;<span class="file">DESCRIPTION</span>&rsquo;
file will be used to set the value for the
<span class="option">--data-compress</span> option of <CODE>R CMD INSTALL</CODE>.
</p>
<p>
</li>
<li>Files &lsquo;<span class="file">R/sysdata.rda</span>&rsquo; of more than 1Mb are now stored
in the lazyload database using <CODE>xz</CODE> compression: this for
example halves the installed size of package <span class="pkg">Imap</span>.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> now ensures that directories
installed from &lsquo;<span class="file">inst</span>&rsquo; have search permission for everyone.
</p>
<p>
It no longer installs files &lsquo;<span class="file">inst/doc/Rplots.ps</span>&rsquo; and
&lsquo;<span class="file">inst/doc/Rplots.pdf</span>&rsquo;.  These are almost certainly left-overs
from <code>Sweave</code> runs, and are often large.
</ul>

</p>

</p>
<p>


<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> The &lsquo;experimental&rsquo; alternative specification of a
name space via <code>.Export()</code> etc is now deprecated.
</p>
<p>
</li>
<li><code>zip.file.extract()</code> is now deprecated.
</p>
<p>
</li>
<li>Zip-ing data sets in packages (and hence <CODE>R CMD
	INSTALL --use-zip-data</CODE> and the <span class="samp">ZipData: yes</span> field in a
<code>DESCRIPTION</code> file) is deprecated: using efficiently
compressed &lsquo;<span class="file">.rda</span>&rsquo; images and lazy-loading of data has
superseded it.
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> <code>identical()</code> could in rare cases generate a warning
about non-pairlist attributes on CHARSXPs.  As these are used for
internal purposes, the attribute check should be skipped.
(Reported by Niels Richard Hansen).
</p>
<p>
</li>
<li>If the filename extension (usually &lsquo;<span class="file">.Rnw</span>&rsquo;) was not
included in a call to <code>Sweave()</code>, source references would not
work properly and the <code>keep.source</code> option failed.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14459">PR#14459</a>)
</p>
<p>
</li>
<li><code>format.data.frame()</code> now keeps zero character column names.
</p>
<p>
</li>
<li><code>pretty(x)</code> no longer raises an error when <code>x</code>
contains solely non-finite values. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14468">PR#14468</a>)
</p>
<p>
</li>
<li>The <code>plot.TukeyHSD()</code> function now uses a line width of
0.5 for its reference lines rather than <span class="samp">lwd = 0</span> (which
caused problems for some PDF and PostScript viewers).
</p>
<p>
</li>
<li>The <code>big.mark</code> argument to <code>prettyNum()</code>,
<code>format()</code>, etc. was inserted reversed if it was more than
one character long.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> failed to check the filenames under
&lsquo;<span class="file">man</span>&rsquo; for Windows' reserved names.
</p>
<p>
</li>
<li>The <code>"Date"</code> and <code>"POSIXt"</code> methods for
<code>seq()</code> could overshoot when <code>to</code> was supplied and
<code>by</code> was specified in months or years.
</p>
<p>
</li>
<li>The internal method of <code>untar()</code> now restores hard
links as file copies rather than symbolic links (which did not
work for cross-directory links).
</p>
<p>
</li>
<li><code>unzip()</code> did not handle zip files which contained
filepaths with two or more leading directories which were not in
the zipfile and did not already exist.  (It is unclear if such
zipfiles are valid and the third-party C code used did not support
them, but <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14462">PR#14462</a> created one.)
</p>
<p>
</li>
<li><code>combn(n, m)</code> now behaves more regularly for the border
case <i>m = 0</i>. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14473">PR#14473</a>)
</p>
<p>
</li>
<li>The rendering of numbers in plotmath expressions (e.g.
<code>expression(10^2)</code>) used the current settings for conversion
to strings rather than setting the defaults, and so could be
affected by what has been done before.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14477">PR#14477</a>)
</p>
<p>
</li>
<li>The methods of <code>napredict()</code> and <code>naresid()</code> for
<code>na.action = na.exclude</code> fits did not work correctly in the
very rare event that every case had been omitted in the fit.
(Reported by Simon Wood.)
</p>
<p>
</li>
<li><code>weighted.residuals(drop0=TRUE)</code> returned a vector when
the residuals were a matrix (e.g. those of class <code>"mlm"</code>).
(Reported by Bill Dunlap.)
</p>
<p>
</li>
<li>Package HTML index files &lsquo;<span class="file">&lt;pkg&gt;/html/00Index.html</span>&rsquo; were
generated with a stylesheet reference that was not correct for
static browsing in libraries.
</p>
<p>
</li>
<li><code>ccf(na.action = na.pass)</code> was not implemented.
</p>
<p>
</li>
<li>The parser accepted some incorrect numeric constants,
e.g. <code>20x2</code>.  (Reported by Olaf Mersmann.)
</p>
<p>
</li>
<li><code>format(*, zero.print)</code> did not always replace the full
zero parts.
</p>
<p>
</li>
<li>Fixes for subsetting or subassignment of <code>"raster"</code>
objects when not both <code>i</code> and <code>j</code> are specified.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> was not always respecting the
<span class="samp">ZipData: yes</span> field of a &lsquo;<span class="file">DESCRIPTION</span>&rsquo; file (although
this is frequently incorrectly specified for packages with no data
or which specify lazy-loading of data).
</p>
<p>
<CODE>R CMD INSTALL --use-zip-data</CODE> was incorrectly implemented
as <span class="option">--use-zipdata</span> since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.9.0.
</p>
<p>
</li>
<li><CODE>source(file, echo=TRUE)</CODE> could fail if the file
contained <span class="samp">#line</span> directives.  It now recovers more gracefully, but
may still display the wrong line if the directive gives incorrect
information.
</p>
<p>
</li>
<li><code>atan(1i)</code> returned <code>NaN+Infi</code> (rather than
<code>0+Infi</code>) on platforms without C99 complex support.
</p>
<p>
</li>
<li><code>library()</code> failed to cache S4 metadata (unlike
<code>loadNamespace()</code>) causing failures in S4-using packages
without a namespace (e.g. those using reference classes).
</p>
<p>
</li>
<li>The function <code>qlogis(lp, log.p=TRUE)</code> no longer
prematurely overflows to <code>Inf</code> when exp(lp) is close to 1.
</p>
<p>
</li>
<li>Updating S4 methods for a group generic function requires
resetting the methods tables for the members of the group (patch
contributed by Martin Morgan).
</p>
<p>
</li>
<li>In some circumstances (including for package <span class="pkg">XML</span>),
<CODE>R CMD INSTALL</CODE> installed version-control directories from
source packages.
</p>
<p>
</li>
<li>Added <code>PROTECT</code> calls to some constructed expressions
used in C level <code>eval</code> calls.
</p>
<p>
</li>
<li><code>utils:::create.post()</code> (used by <code>bug.report()</code>
and <code>help.request()</code>) failed to quote arguments to the
mailer, and so often failed.
</p>
<p>
</li>
<li><code>bug.report()</code> was naive about how to extract
maintainer email addresses from package descriptions, so would
often try mailing to incorrect addresses.
</p>
<p>
</li>
<li><code>debugger()</code> could fail to read the environment of a
call to a function with a <code>...</code> argument.  (Reported by
Charlie Roosen.)
</p>
<p>
</li>
<li><code>prettyNum(c(1i, NA), drop0=TRUE)</code> or
<code>str(NA_complex_)</code> now work correctly.
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.12.1</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> The DVI/PDF reference manual now includes the help pages for
all the standard packages: <span class="pkg">splines</span>, <span class="pkg">stats4</span> and
<span class="pkg">tcltk</span> were previously omitted (intentionally).
</p>
<p>
</li>
<li><a href="http://www.rforge.net">http://www.rforge.net</a> has been added to the default
set of repositories known to <code>setRepositories()</code>.
</p>
<p>
</li>
<li>xz-utils has been updated to version 5.0.0.
</p>
<p>
</li>
<li><code>reshape()</code> now makes use of <code>sep</code> when forming
names during reshaping to wide format.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14435">PR#14435</a>)
</p>
<p>
</li>
<li><code>legend()</code> allows the length of lines to be set by the
end user <EM>via</EM> the new argument <code>seg.len</code>.
</p>
<p>
</li>
<li>New S4 reference class utility methods <code>copy()</code>,
<code>field()</code>, <code>getRefClass()</code> and <code>getClass()</code> have
been added to package <span class="pkg">methods</span>.
</p>
<p>
</li>
<li>When a character value is used for the <code>EXPR</code>
argument in <code>switch()</code>, a warning is given if more than
one unnamed alternative value is given.  This will become an
error in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.13.0.
</p>
<p>
</li>
<li><code>StructTS(type = "BSM")</code> now allows series with just
two seasons.  (Reported by Birgit Erni.)
</ul>

</p>

</p>
<p>


<h4>INSTALLATION</h4>

<p>

<ul>
<li> The PDF reference manual is now built as PDF version 1.5
with object compression, which on platforms for which this is not
the default (notably MiKTeX) halves its size.
</p>
<p>
</li>
<li>Variable <span class="env">FCLIBS</span> can be set during configuration, for
any additional library flags needed when linking a shared object
with the Fortran 9x compiler.  (Needed with Solaris Studio 12.2.)
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> <code>seq.int()</code> no longer sometimes evaluates arguments
twice.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14388">PR#14388</a>)
</p>
<p>
</li>
<li>The <code>data.frame</code> method of <code>format()</code> failed if a
column name was longer than 256 bytes (the maximum length allowed
for an <font face="Courier New,Courier" color="#666666"><b>R</b></font> name).
</p>
<p>
</li>
<li><code>predict(&lt;lm object&gt;, type ="terms", ...)</code> failed if
both <code>terms</code> and <code>interval</code> were specified.  (Reported
by Bill Dunlap.)
</p>
<p>
Also, if <code>se.fit = TRUE</code> the standard errors were reported
for all terms, not just those selected by a non-null <code>terms</code>.
</p>
<p>
</li>
<li>The TRE regular expressions engine could terminate <font face="Courier New,Courier" color="#666666"><b>R</b></font> rather
than give an error when given certain invalid regular expressions.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14398">PR#14398</a>)
</p>
<p>
</li>
<li><code>cmdscale(eig = TRUE)</code> was documented to return <i>n-1</i>
eigenvalues but in fact only returned <code>k</code>.  It now returns
all <i>n</i> eigenvalues.
</p>
<p>
<code>cmdscale(add = TRUE)</code> failed to centre the return
configuration and sometimes lost the labels on the points.  Its
return value was described wrongly (it is always a list and
contains component <code>ac</code>).
</p>
<p>
</li>
<li><code>promptClass()</code> in package <span class="pkg">methods</span> now works for
reference classes and gives a suitably specialized skeleton of
documentation.
</p>
<p>
Also, <code>callSuper()</code> now works via the <code>methods()</code>
invocation as well as for initially specified methods.
</p>
<p>
</li>
<li><code>download.file()</code> could leave the destination file open
if the URL was not able to be opened.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14414">PR#14414</a>)
</p>
<p>
</li>
<li>Assignment of an environment to functions or as an attribute
to other objects now works for S4 subclasses of <code>"environment"</code>.
</p>
<p>
</li>
<li>Use of <span class="samp">[[&lt;-</span> for S4 subclasses of
<code>"environment"</code> generated an infinite recursion from the
method.  The method has been replaced by internal code.
</p>
<p>
</li>
<li>In a reference class S4 method, <code>callSuper()</code> now works in
<code>initialize()</code> methods when there is no explicit superclass
method.
</p>
<p>
</li>
<li><span class="samp">!</span> dropped attributes such as names and dimensions from a
length-zero argument.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14424">PR#14424</a>)
</p>
<p>
</li>
<li>When <code>list2env()</code> created an environment it was missing
a <code>PROTECT</code> call and so was vulnerable to garbage collection.
</p>
<p>
</li>
<li><code>Sweave()</code> with <code>keep.source=TRUE</code> dropped
comments at the start and end of code chunks.  It could also
fail when <span class="samp">\SweaveInput</span> was combined with named chunks.
</p>
<p>
</li>
<li>The Fortran code used by <code>nls(algorithm = "port")</code>
could infinite-loop when compiled with high optimization on a
modern version of <code>gcc</code>, and <code>SAFE_FFLAGS</code> is now used
to make this less likely.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14427">PR#14427</a>, seen with 32-bit Windows
using <code>gcc 4.5.0</code> used from <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.12.0.)
</p>
<p>
</li>
<li><code>sapply()</code> with default <code>simplify = TRUE</code> and
<code>mapply()</code> with default <code>SIMPLIFY = TRUE</code> wrongly
simplified language-like results, as, e.g., in
<code>mapply(1:2, c(3,7), FUN = function(i,j) call(':',i,j))</code>.
</p>
<p>
</li>
<li>Backreferences to undefined patterns in
<code>[g]sub(pcre = TRUE)</code> could cause a segfault.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14431">PR#14431</a>)
</p>
<p>
</li>
<li>The <code>format()</code> (and hence the <code>print()</code>) method
for class <code>"Date"</code> rounded fractional dates towards zero: it
now always rounds them down.
</p>
<p>
</li>
<li>Reference S4 class creation could generate ambiguous
inheritance patterns under very special circumstances.
</p>
<p>
</li>
<li><span class="samp">[[&lt;-</span> turned S4 subclasses of <code>"environment"</code> into
plain environments.
</p>
<p>
</li>
<li>Long titles for help pages were truncated in package indices
and a few other places.
</p>
<p>
</li>
<li>Additional utilities now work correctly with S4 subclasses of
<code>"environment"</code> (<code>rm</code>, locking tools and active
bindings).
</p>
<p>
</li>
<li><code>spec.ar()</code> now also work for the <code>"ols"</code> method.
(Reported by Hans-Ruedi Kuensch.)
</p>
<p>
</li>
<li>The initialization of objects from S4 subclasses of
<code>"environment"</code> now allocates a new environment object.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> has more protection against (probably
erroneous) example or test output which is invalid in the current
locale.
</p>
<p>
</li>
<li><code>qr.X()</code> with column names and pivoting now also pivots
the column names.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14438">PR#14438</a>)
</p>
<p>
</li>
<li><code>unit.pmax()</code> and <code>unit.pmin()</code> in package
<span class="pkg">grid</span> gave incorrect results when all inputs were of length 1.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14443">PR#14443</a>)
</p>
<p>
</li>
<li>The parser for &lsquo;<span class="file">NAMESPACE</span>&rsquo; files ignored misspelled
directives, rather than signalling an error.  For 2.12.x a warning
will be issued, but this will be correctly reported as an error
in later releases. (Reported by Charles Berry.)
</p>
<p>
</li>
<li>Fix for subsetting of <code>"raster"</code> objects when only one
of <code>i</code> or <code>j</code> is specified.
</p>
<p>
</li>
<li><code>grid.raster()</code> in package <span class="pkg">grid</span> did not accept
<code>"nativeRaster"</code> objects (like <code>rasterImage()</code> does).
</p>
<p>
</li>
<li>Rendering raster images in PDF output was resetting the
clipping region.
</p>
<p>
</li>
<li>Rendering of raster images on cairo X11 device was wrong,
particularly when a small image was being scaled up using
interpolation.
</p>
<p>
With cairo &lt; 1.6, will be better than before, though still a
little clunky.  With cairo &gt;= 1.6, should be sweet as.
</p>
<p>
</li>
<li>Several bugs fixed in <code>read.DIF()</code>:  single column
inputs caused errors, cells marked as <code>"character"</code> could
be converted to other types, and (in Windows) copying from the
clipboard failed.
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.12.0</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> Reading a package's &lsquo;<span class="file">CITATION</span>&rsquo; file now defaults to
ASCII rather than Latin-1: a package with a non-ASCII
&lsquo;<span class="file">CITATION</span>&rsquo; file should declare an encoding in its
&lsquo;<span class="file">DESCRIPTION</span>&rsquo; file and use that encoding for the
&lsquo;<span class="file">CITATION</span>&rsquo; file.
</p>
<p>
</li>
<li><code>difftime()</code> now defaults to the <code>"tzone"</code>
attribute of <code>"POSIXlt"</code> objects rather than to the current
timezone as set by the default for the <code>tz</code> argument.  (Wish
of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14182">PR#14182</a>.)
</p>
<p>
</li>
<li><code>pretty()</code> is now generic, with new methods for
<code>"Date"</code> and <code>"POSIXt"</code> classes (based on code
contributed by Felix Andrews).
</p>
<p>
</li>
<li><code>unique()</code> and <code>match()</code> are now faster on
character vectors where all elements are in the global <code>CHARSXP</code>
cache and have unmarked encoding (ASCII).  Thanks to Matthew
Dowle for suggesting improvements to the way the hash code is
generated in &lsquo;<span class="file">unique.c</span>&rsquo;.
</p>
<p>
</li>
<li>The <code>enquote()</code> utility, in use internally, is exported now.
</p>
<p>
</li>
<li><code>.C()</code> and <code>.Fortran()</code> now map non-zero return
values (other than <code>NA_LOGICAL</code>) for logical vectors to
<code>TRUE</code>: it has been an implicit assumption that they are
treated as true.
</p>
<p>
</li>
<li>The <code>print()</code> methods for <code>"glm"</code> and <code>"lm"</code>
objects now insert linebreaks in long calls in the same way that
the <code>print()</code> methods for <code>"summary.[g]lm"</code> objects
have long done.  This does change the layout of the examples for
a number of packages, e.g. <span class="pkg">MASS</span>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14250">PR#14250</a>)
</p>
<p>
</li>
<li><code>constrOptim()</code> can now be used with method
<code>"SANN"</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14245">PR#14245</a>)
</p>
<p>
It gains an argument <code>hessian</code> to be passed to
<code>optim()</code>, which allows all the <code>...</code> arguments to be
intended for <code>f()</code> and <code>grad()</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14071">PR#14071</a>)
</p>
<p>
</li>
<li><code>curve()</code> now allows <code>expr</code> to be an object of
mode <code>"expression"</code> as well as <code>"call"</code> and
<code>"function"</code>.
</p>
<p>
</li>
<li>The <code>"POSIX[cl]t"</code> methods for <code>Axis()</code> have been
replaced by a single method for <code>"POSIXt"</code>.
</p>
<p>
There are no longer separate <code>plot()</code> methods for
<code>"POSIX[cl]t"</code> and <code>"Date"</code>: the default method has
been able to handle those classes for a long time.  This
<EM>inter alia</EM> allows a single date-time object to be
supplied, the wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14016">PR#14016</a>.
</p>
<p>
The methods had a different default (<code>""</code>) for <code>xlab</code>.
</p>
<p>
</li>
<li>Classes <code>"POSIXct"</code>, <code>"POSIXlt"</code> and
<code>"difftime"</code> have generators <code>.POSIXct()</code>,
<code>.POSIXlt()</code> and <code>.difftime()</code>.  Package authors are
advised to make use of them (they are available from <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.11.0) to
proof against planned future changes to the classes.
</p>
<p>
The ordering of the classes has been changed, so <code>"POSIXt"</code>
is now the second class.  See the document &lsquo;Updating
packages for changes in R 2.12.x&rsquo; on
<a href="http://developer.r-project.org">http://developer.r-project.org</a> for the consequences for a
handful of CRAN packages.
</p>
<p>
</li>
<li>The <code>"POSIXct"</code> method of <code>as.Date()</code> allows a
timezone to be specified (but still defaults to UTC).
</p>
<p>
</li>
<li>New <code>list2env()</code> utility function as an inverse of
<code>as.list(&lt;environment&gt;)</code> and for fast multi-<code>assign()</code>
to existing environment.  <code>as.environment()</code> is now generic
and uses <code>list2env()</code> as list method.
</p>
<p>
</li>
<li>There are several small changes to output which &lsquo;zap&rsquo;
small numbers, e.g. in printing quantiles of residuals in
summaries from <code>"lm"</code> and <code>"glm"</code> fits, and in test
statistics in <code>print.anova()</code>.
</p>
<p>
</li>
<li>Special names such as <code>"dim"</code>, <code>"names"</code>, etc, are
now allowed as slot names of S4 classes, with <code>"class"</code> the
only remaining exception.
</p>
<p>
</li>
<li>File &lsquo;<span class="file">.Renviron</span>&rsquo; can have architecture-specific versions
such as &lsquo;<span class="file">.Renviron.i386</span>&rsquo; on systems with sub-architectures.
</p>
<p>
</li>
<li><code>installed.packages()</code> has a new argument
<code>subarch</code> to filter on sub-architecture.
</p>
<p>
</li>
<li>The <code>summary()</code> method for <code>packageStatus()</code> now
has a separate <code>print()</code> method.
</p>
<p>
</li>
<li>The default <code>summary()</code> method returns an object
inheriting from class <code>"summaryDefault"</code> which has a
separate <code>print()</code> method that calls <code>zapsmall()</code> for
numeric/complex values.
</p>
<p>
</li>
<li>The startup message now includes the platform and if used,
sub-architecture: this is useful where different
(sub-)architectures run on the same OS.
</p>
<p>
</li>
<li>The <code>getGraphicsEvent()</code> mechanism now allows multiple windows
to return graphics events, through the new functions
<code>setGraphicsEventHandlers()</code>, <code>setGraphicsEventEnv()</code>, and
<code>getGraphicsEventEnv()</code>.  (Currently implemented in the
<code>windows()</code> and <code>X11()</code> devices.)
</p>
<p>
</li>
<li><code>tools::texi2dvi()</code> gains an <code>index</code> argument,
mainly for use by <CODE>R CMD Rd2pdf</CODE>.
</p>
<p>
It avoids the use of <CODE>texindy</CODE> by <CODE>texinfo</CODE>'s
<CODE>texi2dvi &gt;= 1.157</CODE>, since that does not emulate
'makeindex' well enough to avoid problems with special characters
(such as <span class="samp">(</span>, <span class="samp">{</span>, <span class="samp">!</span>) in indices.
</p>
<p>
</li>
<li>The ability of <code>readLines()</code> and <code>scan()</code> to
re-encode inputs to marked UTF-8 strings on Windows since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.7.0
is extended to non-UTF-8 locales on other OSes.
</p>
<p>
</li>
<li><code>scan()</code> gains a <code>fileEncoding</code> argument to
match <code>read.table()</code>.
</p>
<p>
</li>
<li><code>points()</code> and <code>lines()</code> gain <code>"table"</code>
methods to match <code>plot()</code>.  (Wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=10472">PR#10472</a>.)
</p>
<p>
</li>
<li><code>Sys.chmod()</code> allows argument <code>mode</code> to be a
vector, recycled along <code>paths</code>.
</p>
<p>
</li>
<li>There are <code>|</code>, <code>&amp;</code> and <code>xor()</code> methods for
classes <code>"octmode"</code> and <code>"hexmode"</code>, which work
bitwise.
</p>
<p>
</li>
<li>Environment variables <span class="env">R_DVIPSCMD</span>, <span class="env">R_LATEXCMD</span>,
<span class="env">R_MAKEINDEXCMD</span>, <span class="env">R_PDFLATEXCMD</span> are no longer used
nor set in an <font face="Courier New,Courier" color="#666666"><b>R</b></font> session.  (With the move to
<code>tools::texi2dvi()</code>, the conventional environment variables
<span class="env">LATEX</span>, <span class="env">MAKEINDEX</span> and <span class="env">PDFLATEX</span> will be used.
<code>options("dvipscmd")</code> defaults to the value of <span class="env">DVIPS</span>,
then to <code>"dvips"</code>.)
</p>
<p>
</li>
<li>New function <code>isatty()</code> to see if terminal connections are
redirected.
</p>
<p>
</li>
<li><code>summaryRprof()</code> returns the sampling interval in
component <code>sample.interval</code> and only returns in
<code>by.self</code> data for functions with non-zero self times.
</p>
<p>
</li>
<li><code>print(x)</code> and <code>str(x)</code> now indicate if an empty
list <code>x</code> is named.
</p>
<p>
</li>
<li><code>install.packages()</code> and <code>remove.packages()</code> with
<code>lib</code> unspecified and multiple libraries in
<code>.libPaths()</code> inform the user of the library location used
with a message rather than a warning.
</p>
<p>
</li>
<li>There is limited support for multiple compressed streams on a
file: all of <code>[bgx]zfile()</code> allow streams to be appended to an
existing file, but <code>bzfile()</code> reads only the first stream.
</p>
<p>
</li>
<li>Function <code>person()</code> in package <span class="pkg">utils</span> now uses
a given/family scheme in preference to first/middle/last, is
vectorized to handle an arbitrary number of persons, and gains a
<code>role</code> argument to specify person roles using a controlled
vocabulary (the MARC relator terms).
</p>
<p>
</li>
<li>Package <span class="pkg">utils</span> adds a new <code>"bibentry"</code> class
for representing and manipulating bibliographic information in
enhanced BibTeX style, unifying and enhancing the previously
existing mechanisms.
</p>
<p>
</li>
<li>A <code>bibstyle()</code> function has been added to the
<span class="pkg">tools</span> package with default JSS style for rendering
<code>"bibentry"</code> objects, and a mechanism for registering other
rendering styles.
</p>
<p>
</li>
<li>Several aspects of the display of text help are now
customizable using the new <code>Rd2txt_options()</code> function.
options(<code>"help_text_width"</code>) is no longer used.
</p>
<p>
</li>
<li>Added <span class="samp">\href</span> tag to the Rd format, to allow
hyperlinks to URLs without displaying the full URL.
</p>
<p>
</li>
<li>Added <span class="samp">\newcommand</span> and <span class="samp">\renewcommand</span> tags
to the Rd format, to allow user-defined macros.
</p>
<p>
</li>
<li>New <code>toRd()</code> generic in the <span class="pkg">tools</span> package to
convert objects to fragments of Rd code, and added
<code>"fragment"</code> argument to <code>Rd2txt()</code>, <code>Rd2HTML()</code>,
and <code>Rd2latex()</code> to support it.
</p>
<p>
</li>
<li>Directory &lsquo;<span class="file">R_HOME/share/texmf</span>&rsquo; now follows the TDS
conventions, so can be set as a <code>texmf</code> tree (&lsquo;root
directory&rsquo; in MiKTeX parlance).
</p>
<p>
</li>
<li>S3 generic functions now use correct S4 inheritance when
dispatching on an S4 object.  See <code>?Methods</code>, section on
&ldquo;Methods for S3 Generic Functions&rdquo; for recommendations
and details.
</p>
<p>
</li>
<li><code>format.pval()</code> gains a <code>...</code> argument to pass
arguments such as <code>nsmall</code> to <code>format()</code>.  (Wish of
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=9574">PR#9574</a>)
</p>
<p>
</li>
<li><code>legend()</code> supports <code>title.adj</code>.  (Wish of
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13415">PR#13415</a>)
</p>
<p>
</li>
<li>Added support for subsetting <code>"raster"</code> objects, plus
assigning to a subset, conversion to a matrix (of colour
strings), and comparisons (<span class="samp">==</span> and <span class="samp">!=</span>).
</p>
<p>
</li>
<li>Added a new <code>parseLatex()</code> function (and related
functions <code>deparseLatex()</code> and <code>latexToUtf8()</code>) to
support conversion of bibliographic entries for display in R.
</p>
<p>
</li>
<li>Text rendering of <span class="samp">\itemize</span> in help uses a Unicode
bullet in UTF-8 and most single-byte Windows locales.
</p>
<p>
</li>
<li>Added support for polygons with holes to the graphics
engine.  This is implemented for the <code>pdf()</code>,
<code>postscript()</code>, <code>x11(type="cairo")</code>, <code>windows()</code>,
and <code>quartz()</code> devices (and associated raster formats),
but not for <code>x11(type="Xlib")</code> or <code>xfig()</code> or
<code>pictex()</code>.  The user-level interface is the
<code>polypath()</code> function in <span class="pkg">graphics</span> and
<code>grid.path()</code> in <span class="pkg">grid</span>.
</p>
<p>
</li>
<li>File &lsquo;<span class="file">NEWS</span>&rsquo; is now generated at installation with a
slightly different format: it will be in UTF-8 on platforms using
UTF-8, and otherwise in ASCII.  There is also a PDF version,
&lsquo;<span class="file">NEWS.pdf</span>&rsquo;, installed at the top-level of the R distribution.
</p>
<p>
</li>
<li><code>kmeans(x, 1)</code> now works.  Further, <code>kmeans</code> now
returns between and total sum of squares.
</p>
<p>
</li>
<li><code>arrayInd()</code> and <code>which()</code> gain an argument
<code>useNames</code>.  For <code>arrayInd</code>, the default is now false,
for speed reasons.
</p>
<p>
</li>
<li>As is done for closures, the default <code>print</code> method for
the formula class now displays the associated environment if it is
not the global environment.
</p>
<p>
</li>
<li>A new facility has been added for inserting code into a
package without re-installing it, to facilitate testing
changes which can be selectively added and backed out.  See
<code>?insertSource</code>.
</p>
<p>
</li>
<li>New function <code>readRenviron</code> to (re-)read files in the
format of &lsquo;<span class="file">~/.Renviron</span>&rsquo; and &lsquo;<span class="file">Renviron.site</span>&rsquo;.
</p>
<p>
</li>
<li><code>require()</code> will now return <code>FALSE</code> (and not fail)
if loading the package or one of its dependencies fails.
</p>
<p>
</li>
<li><code>aperm()</code> now allows argument <code>perm</code> to be a
character vector when the array has named dimnames (as the results
of <code>table()</code> calls do).  Similarly, <code>array()</code> allows
<code>MARGIN</code> to be a character vector.  (Based on suggestions of
Michael Lachmann.)
</p>
<p>
</li>
<li>Package <span class="pkg">utils</span> now exports and documents functions
<code>aspell_package_Rd_files()</code> and
<code>aspell_package_vignettes()</code> for spell checking package Rd
files and vignettes using Aspell, Ispell or Hunspell.
</p>
<p>
</li>
<li>Package news can now be given in Rd format, and
<code>news()</code> prefers these &lsquo;<span class="file">inst/NEWS.Rd</span>&rsquo; files to old-style
plain text &lsquo;<span class="file">NEWS</span>&rsquo; or &lsquo;<span class="file">inst/NEWS</span>&rsquo; files.
</p>
<p>
</li>
<li>New simple function <code>packageVersion()</code>.
</p>
<p>
</li>
<li>The PCRE library has been updated to version 8.10.
</p>
<p>
</li>
<li>The standard Unix-alike terminal interface declares its name
to readline as 'R', so that can be used for conditional sections
in &lsquo;<span class="file">~/.inputrc</span>&rsquo; files.
</p>
<p>
</li>
<li>&lsquo;Writing R Extensions&rsquo; now stresses that the standard
sections in &lsquo;<span class="file">.Rd</span>&rsquo; files (other than <span class="samp">\alias</span>,
<span class="samp">\keyword</span> and <span class="samp">\note</span>) are intended to be unique, and
the conversion tools now drop duplicates with a warning.
</p>
<p>
The &lsquo;<span class="file">.Rd</span>&rsquo; conversion tools also warn about an unrecognized type
in a <span class="samp">\docType</span> section.
</p>
<p>
</li>
<li><code>ecdf()</code> objects now have a <code>quantile()</code> method.
</p>
<p>
</li>
<li><code>format()</code> methods for date-time objects now attempt to make
use of a <code>"tzone"</code> attribute with <code>"%Z"</code> and
<code>"%z"</code> formats, but it is not always possible.  (Wish of
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14358">PR#14358</a>.)
</p>
<p>
</li>
<li><code>tools::texi2dvi(file, clean = TRUE)</code> now works in more
cases (e.g. where emulation is used and when &lsquo;<span class="file">file</span>&rsquo; is not in
the current directory).
</p>
<p>
</li>
<li>New function <code>droplevels()</code> to remove unused factor levels.
</p>
<p>
</li>
<li><code>system(command, intern = TRUE)</code> now gives an error on
a Unix-alike (as well as on Windows) if <code>command</code> cannot be
run.  It reports a non-success exit status from running
<code>command</code> as a warning.
</p>
<p>
On a Unix-alike an attempt is made to return the actual exit
status of the command in <code>system(intern = FALSE)</code>: previously
this had been system-dependent but on POSIX-compliant systems the
value return was 256 times the status.
</p>
<p>
</li>
<li><code>system()</code> has a new argument <code>ignore.stdout</code>
which can be used to (portably) ignore standard output.
</p>
<p>
</li>
<li><code>system(intern = TRUE)</code> and <code>pipe()</code> connections
are guaranteed to be available on all builds of <font face="Courier New,Courier" color="#666666"><b>R</b></font>.
</p>
<p>
</li>
<li><code>Sys.which()</code> has been altered to return <code>""</code> if
the command is not found (even on Solaris).
</p>
<p>
</li>
<li>A facility for defining reference-based S4 classes (in the
OOP style of Java, C++, etc.) has been added experimentally to
package <span class="pkg">methods</span>; see <code>?ReferenceClasses</code>.
</p>
<p>
</li>
<li>The <code>predict</code> method for <code>"loess"</code> fits gains an
<code>na.action</code> argument which defaults to <code>na.pass</code> rather
than the previous default of <code>na.omit</code>.
</p>
<p>
Predictions from <code>"loess"</code> fits are now named from the row
names of <code>newdata</code>.
</p>
<p>
</li>
<li>Parsing errors detected during <code>Sweave()</code> processing
will now be reported referencing their original location in the
source file.
</p>
<p>
</li>
<li>New <code>adjustcolor()</code> utility, e.g., for simple
translucent color schemes.
</p>
<p>
</li>
<li><code>qr()</code> now has a trivial <code>lm</code> method with a
simple (fast) validity check.
</p>
<p>
</li>
<li>An experimental new programming model has been added to
package <span class="pkg">methods</span> for reference (OOP-style) classes and
methods.  See <code>?ReferenceClasses</code>.
</p>
<p>
</li>
<li>bzip2 has been updated to version 1.0.6 (bug-fix release).
<span class="option">--with-system-bzlib</span> now requires at least version 1.0.6.
</p>
<p>
</li>
<li>R now provides &lsquo;<span class="file">jss.cls</span>&rsquo; and &lsquo;<span class="file">jss.bst</span>&rsquo; (the class
and bib style file for the Journal of Statistical Software) as
well as &lsquo;<span class="file">RJournal.bib</span>&rsquo; and &lsquo;<span class="file">Rnews.bib</span>&rsquo;, and
<CODE>R CMD</CODE> ensures that the &lsquo;<span class="file">.bst</span>&rsquo; and &lsquo;<span class="file">.bib</span>&rsquo; files
are found by BibTeX.
</p>
<p>
</li>
<li>Functions using the <span class="env">TAR</span> environment variable no longer
quote the value when making <code>system</code> calls.  This allows
values such as <span class="samp">tar --force-local</span>, but does require
additional quotes in, e.g., <code>TAR = "'/path with spaces/mytar'"</code>.
</ul>

</p>

</p>
<p>


<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> Supplying the parser with a character string containing both
octal/hex and Unicode escapes is now an error.
</p>
<p>
</li>
<li>File extension &lsquo;<span class="file">.C</span>&rsquo; for C++ code files in packages is
now defunct.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> no longer supports configuration
files containing Perl configuration variables: use the environment
variables documented in &lsquo;R Internals&rsquo; instead.
</p>
<p>
</li>
<li>The <code>save</code> argument of <code>require()</code> now defaults to
<code>FALSE</code> and <code>save = TRUE</code> is now deprecated.  (This
facility is very rarely actually used, and was superseded by the
<span class="samp">Depends</span> field of the &lsquo;<span class="file">DESCRIPTION</span>&rsquo; file long ago.)
</p>
<p>
</li>
<li><CODE>R CMD check --no-latex</CODE> is deprecated in favour of
<span class="option">--no-manual</span>.
</p>
<p>
</li>
<li><CODE>R CMD Sd2Rd</CODE> is formally deprecated and will be
removed in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.13.0.
</ul>

</p>



<h4>PACKAGE INSTALLATION</h4>

<p>

<ul>
<li> <code>install.packages()</code> has a new argument
<code>libs_only</code> to optionally pass <span class="option">--libs-only</span> to
<CODE>R CMD INSTALL</CODE> and works analogously for Windows binary
installs (to add support for 64- or 32-bit Windows).
</p>
<p>
</li>
<li>When sub-architectures are in use, the installed
architectures are recorded in the <code>Archs</code> field of the
&lsquo;<span class="file">DESCRIPTION</span>&rsquo; file.  There is a new default filter,
<code>"subarch"</code>, in <code>available.packages()</code> to make use of
this.
</p>
<p>
Code is compiled in a copy of the &lsquo;<span class="file">src</span>&rsquo; directory when a
package is installed for more than one sub-architecture: this
avoid problems with cleaning the sources between building
sub-architectures.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL --libs-only</CODE> no longer overrides the
setting of locking, so a previous version of the package will be
restored unless <span class="option">--no-lock</span> is specified.
</ul>

</p>



<h4>UTILITIES</h4>

<p>

<ul>
<li> <CODE>R CMD Rprof|build|check</CODE> are now based on <font face="Courier New,Courier" color="#666666"><b>R</b></font> rather
than Perl scripts.  The only remaining Perl scripts are the
deprecated <CODE>R CMD Sd2Rd</CODE> and <code>install-info.pl</code> (used
only if <code>install-info</code> is not found) as well as some
maintainer-mode-only scripts.
</p>
<p>
<STRONG>NB:</STRONG> because these have been completely rewritten, users
should not expect undocumented details of previous
implementations to have been duplicated.
</p>
<p>
<CODE>R CMD</CODE> no longer manipulates the environment variables
<span class="env">PERL5LIB</span> and <span class="env">PERLLIB</span>.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> has a new argument <span class="option">--extra-arch</span>
to confine tests to those needed to check an additional
sub-architecture.
</p>
<p>
Its check for &ldquo;Subdirectory 'inst' contains no files&rdquo; is
more thorough: it looks for files, and warns if there are only
empty directories.
</p>
<p>
Environment variables such as <span class="env">R_LIBS</span> and those used for
customization can be set for the duration of checking <EM>via</EM> a file
&lsquo;<span class="file">~/.R/check.Renviron</span>&rsquo; (in the format used by
&lsquo;<span class="file">.Renviron</span>&rsquo;, and with sub-architecture specific versions
such as &lsquo;<span class="file">~/.R/check.Renviron.i386</span>&rsquo; taking precedence).
</p>
<p>
There are new options <span class="option">--multiarch</span> to check the package
under all of the installed sub-architectures and
<span class="option">--no-multiarch</span> to confine checking to the
sub-architecture under which <CODE>check</CODE> is invoked.  If
neither option is supplied, a test is done of installed
sub-architectures and all those which can be run on the current
OS are used.
</p>
<p>
Unless multiple sub-architectures are selected, the install done
by <code>check</code> for testing purposes is only of the current
sub-architecture (<EM>via</EM> <CODE>R CMD INSTALL --no-multiarch</CODE>).
</p>
<p>
It will skip the check for non-ascii characters in code or data
if the environment variables <span class="env">_R_CHECK_ASCII_CODE_</span> or
<span class="env">_R_CHECK_ASCII_DATA_</span> are respectively set to <span class="env">FALSE</span>.
(Suggestion of Vince Carey.)
</p>
<p>
</li>
<li><CODE>R CMD build</CODE> no longer creates an &lsquo;<span class="file">INDEX</span>&rsquo; file
(<CODE>R CMD INSTALL</CODE> does so), and <code>--force</code> removes
(rather than overwrites) an existing &lsquo;<span class="file">INDEX</span>&rsquo; file.
</p>
<p>
It supports a file &lsquo;<span class="file">~/.R/build.Renviron</span>&rsquo; analogously to
<CODE>check</CODE>.
</p>
<p>
It now runs build-time <span class="samp">\Sexpr</span> expressions in help files.
</p>
<p>
</li>
<li><CODE>R CMD Rd2dvi</CODE> makes use of <code>tools::texi2dvi()</code>
to process the package manual.  It is now implemented entirely in
<font face="Courier New,Courier" color="#666666"><b>R</b></font> (rather than partially as a shell script).
</p>
<p>
</li>
<li><CODE>R CMD Rprof</CODE> now uses <code>utils::summaryRprof()</code>
rather than Perl.  It has new arguments to select one of the
tables and to limit the number of entries printed.
</p>
<p>
</li>
<li><CODE>R CMD Sweave</CODE> now runs <font face="Courier New,Courier" color="#666666"><b>R</b></font> with <code>--vanilla</code> so
the environment setting of <span class="env">R_LIBS</span> will always be used.
</ul>

</p>



<h4>C-LEVEL FACILITIES</h4>

<p>

<ul>
<li> <code>lang5()</code> and <code>lang6()</code> (in addition to
pre-existing <code>lang[1-4]()</code>) convenience functions for easier
construction of <code>eval()</code> calls.  If you have your own
definition, do wrap it inside <code>#ifndef lang5 .... #endif</code>
to keep it working with old and new <font face="Courier New,Courier" color="#666666"><b>R</b></font>.
</p>
<p>
</li>
<li>Header &lsquo;<span class="file">R.h</span>&rsquo; now includes only the C headers it itself needs,
hence no longer includes <code>errno.h</code>.  (This helps avoid problems
when it is included from C++ source files.)
</p>
<p>
</li>
<li>Headers &lsquo;<span class="file">Rinternals.h</span>&rsquo; and &lsquo;<span class="file">R_ext/Print.h</span>&rsquo; include
the C++ versions of &lsquo;<span class="file">stdio.h</span>&rsquo; and &lsquo;<span class="file">stdarg.h</span>&rsquo;
respectively if included from a C++ source file.
</ul>

</p>

</p>
<p>


<h4>INSTALLATION</h4>

<p>

<ul>
<li> A C99 compiler is now required, and more C99 language features
will be used in the <font face="Courier New,Courier" color="#666666"><b>R</b></font> sources.
</p>
<p>
</li>
<li>Tcl/Tk >= 8.4 is now required (increased from 8.3).
</p>
<p>
</li>
<li>System functions <code>access</code>, <code>chdir</code> and
<code>getcwd</code> are now essential to configure <font face="Courier New,Courier" color="#666666"><b>R</b></font>.  (In practice
they have been required for some time.)
</p>
<p>
</li>
<li><CODE>make check</CODE> compares the output of the examples
from several of the base packages to reference output rather than
the previous output (if any).  Expect some differences due to
differences in floating-point computations between platforms.
</p>
<p>
</li>
<li>File &lsquo;<span class="file">NEWS</span>&rsquo; is no longer in the sources, but generated as
part of the installation.  The primary source for changes is now
&lsquo;<span class="file">doc/NEWS.Rd</span>&rsquo;.
</p>
<p>
</li>
<li>The <code>popen</code> system call is now required to build <font face="Courier New,Courier" color="#666666"><b>R</b></font>.
This ensures the availability of <code>system(intern = TRUE)</code>,
<code>pipe()</code> connections and printing from <code>postscript()</code>.
</p>
<p>
</li>
<li>The <CODE>pkg-config</CODE> file &lsquo;<span class="file">libR.pc</span>&rsquo; now also works
when <font face="Courier New,Courier" color="#666666"><b>R</b></font> is installed using a sub-architecture.
</p>
<p>
</li>
<li><font face="Courier New,Courier" color="#666666"><b>R</b></font> has always required a BLAS that conforms to IE60559
arithmetic, but after discovery of more real-world problems caused
by a BLAS that did not, this is tested more thoroughly in this
version.
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> Calls to <code>selectMethod()</code> by default no longer cache
inherited methods.  This could previously corrupt methods used by
<code>as()</code>.
</p>
<p>
</li>
<li>The densities of non-central chi-squared are now more accurate
in some cases in the extreme tails, e.g. <code>dchisq(2000, 2,
       1000)</code>, as a series expansion was truncated too early.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14105">PR#14105</a>)
</p>
<p>
</li>
<li><code>pt()</code> is more accurate in the left tail for <code>ncp</code>
large, e.g. <code>pt(-1000, 3, 200)</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14069">PR#14069</a>)
</p>
<p>
</li>
<li>The default C function (<code>R_binary</code>) for binary ops now
sets the S4 bit in the result if either argument is an S4 object.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13209">PR#13209</a>)
</p>
<p>
</li>
<li><code>source(echo=TRUE)</code> failed to echo comments that
followed the last statement in a file.
</p>
<p>
</li>
<li>S4 classes that contained one of <code>"matrix"</code>,
<code>"array"</code> or <code>"ts"</code> and also another class now accept
superclass objects in <code>new()</code>.  Also fixes failure to call
<code>validObject()</code> for these classes.
</p>
<p>
</li>
<li>Conditional inheritance defined by argument <code>test</code> in
<code>methods::setIs()</code> will no longer be used in S4 method
selection (caching these methods could give incorrect results).
See <code>?setIs</code>.
</p>
<p>
</li>
<li>The signature of an implicit generic is now used by
<code>setGeneric()</code> when that does not use a definition nor
explicitly set a signature.
</p>
<p>
</li>
<li>A bug in <code>callNextMethod()</code> for some examples with
<code>"..."</code> in the arguments has been fixed.  See file
&lsquo;<span class="file">src/library/methods/tests/nextWithDots.R</span>&rsquo; in the sources.
</p>
<p>
</li>
<li><code>match(x, table)</code> (and hence <code>%in%</code>) now treat
<code>"POSIXlt"</code> consistently with, e.g., <code>"POSIXct"</code>.
</p>
<p>
</li>
<li>Built-in code dealing with environments (<code>get()</code>,
<code>assign()</code>, <code>parent.env()</code>, <code>is.environment()</code> and
others) now behave consistently to recognize S4 subclasses;
<code>is.name()</code> also recognizes subclasses.
</p>
<p>
</li>
<li>The <code>abs.tol</code> control parameter to <code>nlminb()</code>
now defaults to <code>0.0</code> to avoid false declarations of
convergence in objective functions that may go negative.
</p>
<p>
</li>
<li>The standard Unix-alike termination dialog to ask whether to
save the workspace takes a EOF response as <code>n</code> to avoid
problems with a damaged terminal connection.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14332">PR#14332</a>)
</p>
<p>
</li>
<li>Added <code>warn.unused</code> argument to <code>hist.default()</code>
to allow suppression of spurious warnings about graphical
parameters used with <code>plot=FALSE</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14341">PR#14341</a>)
</p>
<p>
</li>
<li><code>predict.lm()</code>, <code>summary.lm()</code>, and indeed
<code>lm()</code> itself had issues with residual DF in zero-weighted
cases (the latter two only in connection with empty
models). (Thanks to Bill Dunlap for spotting the
<code>predict()</code> case.)
</p>
<p>
</li>
<li><code>aperm()</code> treated <code>resize = NA</code> as <code>resize =
      TRUE</code>.
</p>
<p>
</li>
<li><code>constrOptim()</code> now has an improved convergence
criterion, notably for cases where the minimum was (very close to)
zero; further, other tweaks inspired from code proposals by Ravi
Varadhan.
</p>
<p>
</li>
<li>Rendering of S3 and S4 methods in man pages has been
corrected and made consistent across output formats.
</p>
<p>
</li>
<li>Simple markup is now allowed in <span class="samp">\title</span> sections
in &lsquo;<span class="file">.Rd</span>&rsquo; files.
</p>
<p>
</li>
<li>The behaviour of <code>as.logical()</code> on factors (to use the
levels) was lost in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.6.0 and has been restored.
</p>
<p>
</li>
<li><code>prompt()</code> did not backquote some default arguments in
the <span class="samp">\usage</span> section.  (Reported by Claudia Beleites.)
</p>
<p>
</li>
<li><code>writeBin()</code> disallows attempts to write 2GB or
more in a single call. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14362">PR#14362</a>)
</p>
<p>
</li>
<li><code>new()</code> and <code>getClass()</code> will now work if Class
is a subclass of <code>"classRepresentation"</code> and should also be
faster in typical calls.
</p>
<p>
</li>
<li>The <code>summary()</code> method for data frames makes a better
job of names containing characters invalid in the current locale.
</p>
<p>
</li>
<li><code>[[</code> sub-assignment for factors could create an invalid
factor (reported by Bill Dunlap).
</p>
<p>
</li>
<li><code>Negate(f)</code> would not evaluate argument <code>f</code>
until first use of returned function (reported by Olaf Mersmann).
</p>
<p>
</li>
<li><code>quietly=FALSE</code> is now also an optional argument of
<code>library()</code>, and consequently, <code>quietly</code> is now
propagated also for loading dependent packages, e.g., in
<code>require(*, quietly=TRUE)</code>.
</p>
<p>
</li>
<li>If the loop variable in a <code>for</code> loop was deleted, it
would be recreated as a global variable.  (Reported by Radford
Neal; the fix includes his optimizations as well.)
</p>
<p>
</li>
<li>Task callbacks could report the wrong expression when
the task involved parsing new code. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14368">PR#14368</a>)
</p>
<p>
</li>
<li><code>getNamespaceVersion()</code> failed; this was an
accidental change in 2.11.0. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14374">PR#14374</a>)
</p>
<p>
</li>
<li><code>identical()</code> returned <code>FALSE</code> for external
pointer objects even when the pointer addresses were the same.
</p>
<p>
</li>
<li><code>L$a@x[] &lt;- val</code> did not duplicate in a case it should have.
</p>
<p>
</li>
<li><code>tempfile()</code> now always gives a random file name (even
if the directory is specified) when called directly after
startup and before the <font face="Courier New,Courier" color="#666666"><b>R</b></font> RNG had been used.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14381">PR#14381</a>)
</p>
<p>
</li>
<li><code>quantile(type=6)</code> behaved inconsistently.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14383">PR#14383</a>)
</p>
<p>
</li>
<li><code>backSpline(.)</code> behaved incorrectly when the knot
sequence was decreasing.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14386">PR#14386</a>)
</p>
<p>
</li>
<li>The reference BLAS included in <font face="Courier New,Courier" color="#666666"><b>R</b></font> was assuming that
<code>0*x</code> and <code>x*0</code> were always zero (whereas they could be
<code>NA</code> or <code>NaN</code> in IEC 60559 arithmetic).  This was seen
in results from <code>tcrossprod</code>, and for example that
<code>log(0) %*% 0</code> gave <code>0</code>.
</p>
<p>
</li>
<li>The calculation of whether text was completely outside
the device region (in which case, you draw nothing)
was wrong for screen devices (which have [0, 0] at top-left).
The symptom was (long) text disappearing when
resizing a screen window (to make it smaller).  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14391">PR#14391</a>)
</p>
<p>
</li>
<li><code>model.frame(drop.unused.levels = TRUE)</code> did not
take into account <code>NA</code> values of factors when deciding to
drop levels. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14393">PR#14393</a>)
</p>
<p>
</li>
<li><code>library.dynam.unload</code> required an absolute path for
<code>libpath</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14385">PR#14385</a>)
</p>
<p>
Both <code>library()</code> and <code>loadNamespace()</code> now record
absolute paths for use by <code>searchpaths()</code> and
<code>getNamespaceInfo(ns, "path")</code>.
</p>
<p>
</li>
<li>The self-starting model <code>NLSstClosestX</code> failed if some
deviation was exactly zero.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14384">PR#14384</a>)
</p>
<p>
</li>
<li><code>X11(type = "cairo")</code> (and other devices such as
<code>png</code> using cairographics) and which use Pango font selection
now work around a bug in Pango when very small fonts (those with
sizes between 0 and 1 in Pango's internal units) are requested.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14369">PR#14369</a>)
</p>
<p>
</li>
<li>Added workaround for the font problem with <code>X11(type =
      "cairo")</code> and similar on Mac OS X whereby italic and bold styles
were interchanged.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13463">PR#13463</a> amongst many other reports.)
</p>
<p>
</li>
<li><code>source(chdir = TRUE)</code> failed to reset the working
directory if it could not be determined &ndash; that is now an error.
</p>
<p>
</li>
<li>Fix for crash of <code>example(rasterImage)</code> on
<code>x11(type="Xlib")</code>.
</p>
<p>
</li>
<li>Force Quartz to bring the on-screen display up-to-date
immediately before the snapshot is taken by <code>grid.cap()</code>
in the Cocoa implementation. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14260">PR#14260</a>)
</p>
<p>
</li>
<li><code>model.frame</code> had an unstated 500 byte limit on
variable names.  (Example reported by Terry Therneau.)
</p>
<p>
</li>
<li>The 256-byte limit on names is now documented.
</p>
<p>
</li>
<li>Subassignment by <code>[</code>, <code>[[</code> or <code>$</code> on an
expression object with value <code>NULL</code> coerced the object to a
list.
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.11.1 patched</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> <code>install.packages()</code> has a new optional argument
<code>INSTALL_opts</code> which can be used to pass options to
<CODE>R CMD INSTALL</CODE> for source-package installs.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now runs the package-specific tests
with <span class="env">LANGUAGE=en</span> to facilitate comparison to
&lsquo;<span class="file">.Rout.save</span>&rsquo; files.
</p>
<p>
</li>
<li><code>sessionInfo()</code> gives more detailed platform
information, including 32/64-bit and the sub-architecture if one
is used.
</ul>

</p>

</p>
<p>


<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> The use of Perl configuration variables for <CODE>R CMD
	check</CODE> (as previously documented in &lsquo;Writing R
Extensions&rsquo;) is deprecated and will be removed in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.12.0.  Use
the environment variables documented in &lsquo;R Internals&rsquo;
instead.
</ul>

</p>

</p>
<p>


<h4>BUG FIXES</h4>

<p>

<ul>
<li> <CODE>R CMD Rd2dvi</CODE> failed if run from a path containing
space(s).  This also affected <CODE>R CMD check</CODE>, which calls
<CODE>Rd2dvi</CODE>.
</p>
<p>
</li>
<li><code>stripchart()</code> could fail with an empty factor
level.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14317">PR#14317</a>)
</p>
<p>
</li>
<li>Text help rendering of <span class="samp">\tabular{}</span> has been
improved: under some circumstances leading blank columns were
not rendered.
</p>
<p>
</li>
<li><code>strsplit(x, fixed=TRUE)</code> marked UTF-8 strings with the
local encoding when no splits were found.
</p>
<p>
</li>
<li><code>weighted.mean(NA, na.rm=TRUE)</code> and similar now returns
<code>NaN</code> again, as it did prior to <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.10.0.
</p>
<p>
</li>
<li><CODE>R CMD</CODE> had a typo in its detection of whether the
environment variable <span class="env">TEXINPUTS</span> was set (reported by Martin
Morgan).
</p>
<p>
</li>
<li>The command-line parser could mistake
<span class="option">--file=size...</span> for one of the options for setting limits
for Ncells or Vcells.
</p>
<p>
</li>
<li>The internal <code>strptime()</code> could corrupt its copy of the
timezone which would then lead to spurious warnings. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14338">PR#14338</a>)
</p>
<p>
</li>
<li><code>dir.create(recursive = TRUE)</code> could fail if one of the
components existed but was a directory on a read-only file system.
(Seen on Solaris, where the error code returned is not even listed
as possible on the man page.)
</p>
<p>
</li>
<li>The <code>postscript()</code> and <code>pdf()</code> devices will now
allow <code>lwd</code> values less than 1 (they used to force such
values to be 1).
</p>
<p>
</li>
<li>Fixed font face for CID fonts in <code>pdf()</code> graphics output.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14326">PR#14326</a>)
</p>
<p>
</li>
<li><code>GERaster()</code> now checks for width or height of zero and
does nothing in those cases; previously the behaviour was
undefined, probably device-specific, and possibly dangerous.
</p>
<p>
</li>
<li><code>wilcox.test(x, y, conf.int = TRUE)</code> failed with an unhelpful
message if <code>x</code> and <code>y</code> were constant vectors, and
similarly in the one-sample case.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14329">PR#14329</a>)
</p>
<p>
</li>
<li>Improperly calling <code>Recall()</code> from outside a function
could cause a segfault.  (Reported by Robert McGehee.)
</p>
<p>
</li>
<li><span class="samp">\Sexpr[result=rd]</span> in an Rd file added a
spurious newline, which was displayed as extra whitespace when
rendered.
</p>
<p>
</li>
<li><code>require(save = TRUE)</code> recorded the names of packages
it failed to load.
</p>
<p>
</li>
<li><code>packageStatus()</code> could return a data frame with
duplicate row names which could then not be printed.
</p>
<p>
</li>
<li><code>txtProgressBar(style = 2)</code> did not work correctly.
</p>
<p>
<code>txtProgressBar(style = 3)</code> did not display until a
non-minimum value was set.
</p>
<p>
</li>
<li><code>contour()</code> did not display dashed line types
properly when contour lines were labelled. (Reported by
David B. Thompson.)
</p>
<p>
</li>
<li><code>tools::undoc()</code> again detects undocumented data
objects.  Of course, this also affects <CODE>R CMD check</CODE>.
</p>
<p>
</li>
<li><code>ksmooth(x,NULL)</code> no longer segfaults.
</p>
<p>
</li>
<li><code>approxfun()</code>, <code>approx()</code>, <code>splinefun()</code>
and <code>spline()</code> could be confused by <code>x</code> values that
were different but so close as to print identically.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14377">PR#14377</a>)
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.11.1</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> <CODE>R CMD INSTALL</CODE> checks if dependent packages are
available early on in the installation of source packages,
thereby giving clearer error messages.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL --build</CODE> now names the file in the
format used for Mac OS X binary files on that platform.
</p>
<p>
</li>
<li><code>BIC()</code> in package <span class="pkg">stats4</span> now also works with
multiple fitted models, analogously to <code>AIC()</code>.
</ul>

</p>



<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> Use of file extension &lsquo;<span class="file">.C</span>&rsquo; for C++ code in packages is now
deprecated: it has caused problems for some <CODE>make</CODE>s on
case-insensitive file systems (although it currently works
with the recommended toolkits).
</ul>

</p>



<h4>INSTALLATION</h4>

<p>

<ul>
<li> Command <CODE>gnutar</CODE> is preferred to <CODE>tar</CODE>
when configure sets <span class="env">TAR</span>.  This is needed on Mac OS 10.6,
where the default <code>tar</code>, <code>bsdtar 2.6.2</code>, has been
reported to produce archives with illegal extensions to tar
(according to the POSIX standard).
</ul>

</p>



<h4>BUG FIXES</h4>

<p>

<ul>
<li> The C function <code>mkCharLenCE</code> now no longer reads past
<code>len</code> bytes (unlikely to be a problem except in user
code).  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14246">PR#14246</a>)
</p>
<p>
</li>
<li>On systems without any default <span class="env">LD_LIBRARY_PATH</span> (not
even &lsquo;<span class="file">/usr/local/lib</span>&rsquo;), <span class="env">[DY]LIB_LIBRARY_PATH</span> is now
set without a trailing colon.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13637">PR#13637</a>)
</p>
<p>
</li>
<li>More efficient implementation of <code>utf8ToInt()</code> on long
multi-byte strings with many multi-byte characters.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14262">PR#14262</a>)
</p>
<p>
</li>
<li><code>aggregate.ts()</code> gave platform-dependent results due to
rounding error for <code>ndeltat != 1</code>.
</p>
<p>
</li>
<li><code>package.skeleton()</code> sometimes failed to fix filenames
for &lsquo;<span class="file">.R</span>&rsquo; or &lsquo;<span class="file">.Rd</span>&rsquo; files to start with an alphanumeric.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14253">PR#14253</a>)
</p>
<p>
It also failed when only an S4 class without any methods was
defined.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14280">PR#14280</a>)
</p>
<p>
</li>
<li><code>splinefun(method = <code>"monoH.FC"</code>)</code> was not
quite monotone in rare cases.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14215">PR#14215</a>)
</p>
<p>
</li>
<li><code>Rhttpd</code> no longer crashes due to <code>SIGPIPE</code> when
the client closes the connection prematurely.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14266">PR#14266</a>)
</p>
<p>
</li>
<li><code>format.POSIXlt()</code> could cause a stack overflow and
crash when used on very long vectors.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14267">PR#14267</a>)
</p>
<p>
</li>
<li><code>Rd2latex()</code> incorrectly escaped special characters in
<span class="samp">\usage</span> sections.
</p>
<p>
</li>
<li><code>mcnemar.test()</code> could alter the levels (dropping
unused levels) if passed <code>x</code> and <code>y</code> as factors
(reported by Greg Snow).
</p>
<p>
</li>
<li><CODE>Rd2pdf</CODE> sometimes needed a further
<CODE>pdflatex</CODE> pass to get hyperlinked pages correct.
</p>
<p>
</li>
<li><code>interaction()</code> produced malformed results when levels were
duplicated, causing segfaults in <code>split()</code>.
</p>
<p>
</li>
<li><code>cut(d, breaks = &lt;n&gt;)</code> now also works for <code>"Date"</code>
or <code>"POSIXt"</code> argument <code>d</code>.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14288">PR#14288</a>)
</p>
<p>
</li>
<li><code>memDecompress()</code> could decompress incompletely rare
<code>xz</code>-compressed input due to incorrect documentation of
<CODE>xz utils</CODE>.  (Report and patch from Olaf Mersmann.)
</p>
<p>
</li>
<li>The S4 <code>initialize()</code> methods for <code>"matrix"</code>,
<code>"array"</code>, and <code>"ts"</code> have been fixed to call
<code>validObject()</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14284">PR#14284</a>)
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> now behaves the same way with or
without <span class="option">--no-multiarch</span> on platforms with only one
installed architecture.  (It used to clean the &lsquo;<span class="file">src</span>&rsquo;
directory without <span class="option">--no-multiarch</span>.)
</p>
<p>
</li>
<li><code>[&lt;-.data.frame</code> was not quite careful enough in
assigning (and potentially deleting) columns
right-to-left.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14263">PR#14263</a>)
</p>
<p>
</li>
<li><code>rbeta(n, a, b)</code> no longer occasionally returns
<code>NaN</code> for <code>a &gt;&gt; 1 &gt; b</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14291">PR#14291</a>)
</p>
<p>
</li>
<li><code>pnorm(x, log.p = TRUE)</code> could return <code>NaN</code> not
<code>-Inf</code> for <code>x</code> near (minus for <code>lower.tail=TRUE</code>)
the largest representable number.
</p>
<p>
</li>
<li>Compressed data files &lsquo;<span class="file">*.(txt|tab|csv).(gz|bz2|xz)</span>&rsquo;
were not recognized for the list of data topics and hence for
packages using <code>LazyData</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14273">PR#14273</a>)
</p>
<p>
</li>
<li><code>textConnection()</code> did an unnecessary translation on
strings in a foreign encoding (e.g. UTF-8 strings on Windows) and
so was slower than it could have been on very long input strings.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14286">PR#14286</a>)
</p>
<p>
</li>
<li><code>tools::Rd2txt()</code> did not render poorly written Rd
files consistently with other renderers.
</p>
<p>
It computed widths of strings that would be <code>print()</code>ed with
escapes incorrectly, for example in the computation of column
width for <span class="samp">\tabular</span>.
</p>
<p>
</li>
<li><code>na.action()</code> did not extract the <code>na.action</code>
component as documented.
</p>
<p>
</li>
<li><code>do.call()</code>ing <code>NextMethod</code> in erronous ways no
longer segfaults. (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13487">PR#13487</a>)
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.11.0</h3>

<p>


<h4>SIGNIFICANT USER-VISIBLE CHANGES</h4>

<p>

<ul>
<li> Packages must have been installed under <font face="Courier New,Courier" color="#666666"><b>R</b></font> &gt;= 2.10.0, as the
current help system is the only one now supported.
</p>
<p>
</li>
<li>A port to 64-bit Windows is now available as well as binary
package repositiories: see the &lsquo;R Administration and
Installation Manual&rsquo;.
</p>
<p>
</li>
<li>Argument matching for primitive functions is now done in the
same way as for interpreted functions except for the deliberate
exceptions
<pre>
	 call switch .C .Fortran .Call .External
       </pre>
all of which use positional matching for their first argument,
and also some internal-use-only primitives.
</p>
<p>
</li>
<li>The default device for command-line <font face="Courier New,Courier" color="#666666"><b>R</b></font> at the console on Mac OS X
is now <code>quartz()</code> and not <code>X11()</code>.
</ul>

</p>



<h4>NEW FEATURES</h4>

<p>

<ul>
<li> The <code>open</code> modes for connections are now interpreted
more consistently.  <code>open = "r"</code> is now equivalent to
<code>open = "rt"</code> for all connections.  The default <code>open =
       ""</code> now means <code>"rt"</code> for all connections except the
compressed-file connections <code>gzfile()</code>, <code>bzfile()</code> and
<code>xzfile()</code> for which it means <code>"rb"</code>.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> now uses the internal <code>untar()</code>
function in package <span class="pkg">utils</span>: this ensures that all platforms
can install <CODE>bzip2</CODE>- and <CODE>xz</CODE>-compressed
tarballs.  In case this causes problems (as it has on some
Windows file systems when run from Cygwin tools) it can be
overridden by the environment variable <span class="env">R_INSTALL_TAR</span>:
setting this to a modern external tar program will speed up
unpacking of large (tens of Mb or more) tarballs.
</p>
<p>
</li>
<li><code>help(try.all.packages = TRUE)</code> is much faster
(although the time taken by the OS to find all the packages the
first time it is used can dominate the time).
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> has a new option <span class="option">--timings</span>
to record per-example timings in file
&lsquo;<span class="file">&lt;pkg&gt;.Rcheck/&lt;pkg&gt;-Ex.timings</span>&rsquo;.
</p>
<p>
</li>
<li>The TRE library has been updated to version 0.8.0 (minor bugfixes).
</p>
<p>
</li>
<li><code>grep[l]</code>, <code>[g]sub</code> and <code>[g]regexpr</code> now work
in bytes in an 8-bit locales if there is no marked UTF-8 input
string: this will be somewhat faster, and for <code>[g]sub()</code>
give the result in the native encoding rather than in UTF-8
(which returns to the behaviour prior to <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.10.0).
</p>
<p>
</li>
<li>A new argument <code>skipCalls</code> has been added to
<code>browser()</code> so that it can report the original context when
called by other debugging functions.
</p>
<p>
</li>
<li>More validity checking of UTF-8 and MBCS strings is done by
<code>agrep()</code> and the regular-expression matching functions.
</p>
<p>
</li>
<li>The undocumented restriction on <code>gregexpr()</code> to
<code>length(text) &gt; 0</code> has been removed.
</p>
<p>
</li>
<li>Package <span class="pkg">tcltk</span> now sends strings to Tcl in UTF-8: this
means that strings with a marked UTF-8 encoding are supported in
non-UTF-8 locales.
</p>
<p>
</li>
<li>The graphics engine now supports rendering of raster (bitmap)
images, though not all graphics devices can provide (full)
support.  Packages providing graphics devices (e.g., <code>Cairo</code>,
<code>RSvgDevice</code>, <code>cairoDevice</code>) will need to be reinstalled.
</p>
<p>
There is also support in the graphics engine for capturing
raster images from graphics devices (again not supported
on all graphics devices).
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now also checks if the package and
namespace can be unloaded: this provides a check of the
<code>.Last.lib()</code> and <code>.onUnload()</code> hook functions (unless
<span class="option">--install=fake</span>).
</p>
<p>
</li>
<li><code>prop.table(x)</code> now accepts a one-dimensional table for
<code>x</code>.
</p>
<p>
</li>
<li>A new function <code>vapply()</code> has been added, based on a
suggestion from Bill Dunlap.  It requires that a template for the
function value be specified, and uses it to determine the output
type and to check for consistency in the function values.
</p>
<p>
</li>
<li>The main HTML help page now links to a reformatted copy of
this &lsquo;<span class="file">NEWS</span>&rsquo; file.  (Suggested by Henrik Bengtsson.)  Package
index files link to the package &lsquo;<span class="file">DESCRIPTION</span>&rsquo; and
&lsquo;<span class="file">NEWS</span>&rsquo; files and a list of demos when using dynamic help.
</p>
<p>
</li>
<li>The <code>[</code> method for class <code>"AsIs"</code> allows the next
method to change the underlying class.  (Wish of Jens
Oehlschlgel.)
</p>
<p>
</li>
<li><code>write.csv[2]</code> no longer allow argument <code>append</code>
to be changed: as ever, direct calls to <code>write.table()</code> give
more flexibility as well as more room for error.
</p>
<p>
</li>
<li>The index page for HTML help for a package now collapses
multiple signatures for S4 methods into a single entry.
</p>
<p>
</li>
<li>The use of <code>.required</code> by <code>require()</code> and
<code>detach()</code> has been replaced by <code>.Depends</code> which is set
from the <code>Depends</code> field of a package (even in packages with
name spaces).  By default <code>detach()</code> prevents such
dependencies from being detached: this can be overridden by the
argument <code>force</code>.
</p>
<p>
</li>
<li><code>bquote()</code> has been extended to work on function
definitions.  (Wish of
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14031">PR#14031</a>).
</p>
<p>
</li>
<li><code>detach()</code> when applied to an object other than a
package returns the environment that has been detached, to
parallel <code>attach()</code>.
</p>
<p>
</li>
<li><code>readline()</code> in non-interactive use returns <code>""</code>
and does not attempt to read from the &lsquo;terminal&rsquo;.
</p>
<p>
</li>
<li>New function <code>file_ext()</code> in package <span class="pkg">tools</span>.
</p>
<p>
</li>
<li><code>xtfrm()</code> is now primitive and internally generic, as
this allows S4 methods to be set on it without name-space scoping
issues.
</p>
<p>
There are now <code>"AsIs"</code> and <code>"difftime"</code> methods, and
the default method uses <code>unclass(x)</code> if <code>is.numeric(x)</code>
is true (which will be faster but relies on <code>is.numeric()</code>
having been set correctly for the class).
</p>
<p>
</li>
<li><code>is.numeric(x)</code> is now false for a <code>"difftime"</code>
object (multiplication and division make no sense for such
objects).
</p>
<p>
</li>
<li>The default method of <code>weighted.mean(x, w)</code> coerces
<code>w</code> to be numeric (aka double); previously only integer
weights were coerced.  Zero weights are handled specially so an
infinite value with zero weight does not force an <code>NaN</code>
result.
</p>
<p>
There is now a <code>"difftime"</code> method.
</p>
<p>
</li>
<li><code>bug.report()</code> now has arguments <code>package</code> and
<code>lib.loc</code> to generate bug reports about packages.  When
this is used, it looks for a <code>BugReports</code> field in the
package &lsquo;<span class="file">DESCRIPTION</span>&rsquo; file, which will be assumed to be a
URL at which to submit the report, and otherwise generates an
email to the package maintainer.  (Suggested by Barry
Rowlingson.)
</p>
<p>
</li>
<li><code>quantile()</code> now has a method for the date-time class
<code>"POSIXt"</code>, and types 1 and 3 (which never interpolate) work
for Dates and ordered factors.
</p>
<p>
</li>
<li><code>length(&lt;POSIXlt&gt;)</code> now returns the length of the
corresponding abstract timedate-vector rather than always 9 (the
length of the underlying list structure).  (Wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14073">PR#14073</a>
and <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=10507">PR#10507</a>.)
</p>
<p>
</li>
<li>The <code>readline</code> completion backend no longer sorts
possible completions alphabetically (e.g., function argument
names) if <font face="Courier New,Courier" color="#666666"><b>R</b></font> was built with <code>readline &gt;= 6</code>.
</p>
<p>
</li>
<li><code>select.list()</code> gains a <code>graphics</code> argument to
allow Windows/Mac users to choose the text interface.  This
changes the behaviour of <code>new.packages(ask=TRUE)</code> to be like
<code>update.packages(ask=TRUE)</code> on those platforms in using a
text menu: use ask=<code>"graphics"</code> for a graphical menu.
</p>
<p>
</li>
<li>New function <code>chooseBioCmirror()</code> to set the
<code>"BioC_mirror"</code> option.
</p>
<p>
</li>
<li>The <font face="Courier New,Courier" color="#666666"><b>R</b></font> grammar now prevents using the argument <code>name</code>
in signatures of S4 methods for <code>$</code> and <code>$&lt;-</code>, since
they will always be called with a character string value for
<code>name</code>.  The implicit S4 generic functions have been
changed to reflect this: packages which included <code>name</code> in
the signature of their methods need to be updated and
re-installed.
</p>
<p>
</li>
<li>The handling of the <code>method</code> argument of <code>glm()</code>
has been refined following suggestions by Ioannis Kosmidis and
Heather Turner.
</p>
<p>
</li>
<li><code>str()</code> gains a new argument <code>list.len</code> with
default 99, limiting the number of <code>list()</code> items (per
level), thanks to suggestions from David Winsenius.
</p>
<p>
</li>
<li>Having formal arguments of an S4 method in a different order
from the generic is now an error (the warning having been
ignored by some package maintainers for a long time).
</p>
<p>
</li>
<li>New functions <code>enc2native()</code> and <code>enc2utf8()</code>
convert character vectors with possibly marked encodings to the
current locale and UTF-8 respectively.
</p>
<p>
</li>
<li>Unrecognized escapes and embedded nuls in character strings are
now an error, not just a warning.  Thus option <code>"warnEscapes"</code>
is no longer needed.  <code>rawToChar()</code> now removes trailing nuls
silently, but other embedded nuls become errors.
</p>
<p>
</li>
<li>Informational messages about masked objects displayed when a
package is attached are now more compact, using <code>strwrap()</code>
instead of one object per line.
</p>
<p>
</li>
<li><code>print.rle()</code> gains argument <code>prefix</code>.
</p>
<p>
</li>
<li><code>download.file()</code> gains a <code>"curl"</code> method, mainly
for use on platforms which have <CODE>curl</CODE> but not
<CODE>wget</CODE>, but also for some hard-to-access URLs.
</p>
<p>
</li>
<li>In <code>Rd</code>, <span class="samp">\eqn</span> and <span class="samp">\deqn</span> will render in
HTML (and convert to text) upper- and lower-case Greek letters
(entered as <span class="samp">\alpha</span> ...), <span class="samp">\ldots</span>, <span class="samp">\dots</span>,
<span class="samp">\ge</span> and <span class="samp">\le</span>.
</p>
<p>
</li>
<li><code>utf8ToInt()</code> and <code>intToUtf8()</code> now map <code>NA</code> inputs
to <code>NA</code> outputs.
</p>
<p>
</li>
<li><code>file()</code> has a new argument <code>raw</code> which may help
if it is used with something other than a regular file, e.g. a
character device.
</p>
<p>
</li>
<li>New function <code>strtoi()</code>, a wrapper for the C function
<code>strtol</code>.
</p>
<p>
</li>
<li><code>as.octmode()</code> and <code>as.hexmode()</code> now allow inputs
of length other than one.
</p>
<p>
The <code>format()</code> and <code>print()</code> methods for
<code>"octmode"</code> now preserve names and dimensions (as those for
<code>"hexmode"</code> did).
</p>
<p>
The <code>format()</code> methods for classes <code>"octmode"</code> and
<code>"hexmode"</code> gain a <code>width</code> argument.
</p>
<p>
</li>
<li><code>seq.int()</code> returns an integer result in some further cases
where <code>seq()</code> does, e.g. <code>seq.int(1L, 9L, by = 2L)</code>.
</p>
<p>
</li>
<li>Added <span class="samp">\subsection{}{}</span> macro to Rd syntax, for
subsections within sections.
</p>
<p>
</li>
<li>n-dimensional arrays with dimension names can now be indexed
by an n-column character matrix.  The indices are matched against
the dimension names.  <code>NA</code> indices are propagated to the
result.  Unmatched values and <code>""</code> are not allowed and
result in an error.
</p>
<p>
</li>
<li><code>interaction(drop=TRUE)</code> uses less memory (related to
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14121">PR#14121</a>).
</p>
<p>
</li>
<li><code>summary()</code> methods have been added to the
<code>"srcref"</code> and <code>"srcfile"</code> classes, and various
encoding issues have been cleaned up.
</p>
<p>
</li>
<li>If option <code>"checkPackageLicense"</code> is set to <code>TRUE</code> (not
currently the default), users will be asked to agree to
non-known-to-be-FOSS package licences at first use.
</p>
<p>
</li>
<li>Checking <code>setAs(a, b)</code> methods only gives a message
instead of a warning, when one of <code>a</code> or <code>b</code> is
unknown.
</p>
<p>
</li>
<li>New function <code>norm()</code> to compute a matrix norm.
<code>norm()</code> and also <code>backsolve()</code> and <code>sample()</code>
have implicit S4 generics.
</p>
<p>
</li>
<li>Files &lsquo;<span class="file">Renviron.site</span>&rsquo; and &lsquo;<span class="file">Rprofile.site</span>&rsquo; can have
architecture-specific versions on systems with sub-architectures.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now (by default) also checks Rd files
for auto-generated content in need of editing, and missing
argument descriptions.
</p>
<p>
</li>
<li><code>aggregate()</code> gains a formula method thanks to a
contribution by Arni Magnusson.  The data frame method now allows
summary functions to return arbitrarily many values.
</p>
<p>
</li>
<li><code>path.expand()</code> now propagates <code>NA</code> values rather
than converting them to <code>"NA"</code>.
</p>
<p>
</li>
<li><code>file.show()</code> now disallows <code>NA</code> values for file names,
headers, and pager.
</p>
<p>
</li>
<li>The &lsquo;fuzz&rsquo; used by <code>seq()</code> and <code>seq.int()</code> has
been reduced from <code>1e-7</code> to <code>1e-10</code>, which should be
ample for the double-precision calculations used in <font face="Courier New,Courier" color="#666666"><b>R</b></font>.  It
ensures that the fuzz never comes into play with sequences of
integers (wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14169">PR#14169</a>).
</p>
<p>
</li>
<li>The default value of <code>RSiteSearch(restrict=)</code> has been
changed to include vignettes but to exclude R-help.  The R-help
archives available have been split, with a new option of
<code>"Rhelp10"</code> for those from 2010.
</p>
<p>
</li>
<li>New function <code>rasterImage()</code> in the <code>graphics</code>
package for drawing raster images.
</p>
<p>
</li>
<li><code>stats:::extractAIC.coxph()</code> now omits aliased terms
when computing the degrees of freedom (suggestion of Terry
Therneau).
</p>
<p>
</li>
<li><code>cor()</code> and <code>cov()</code> now test for misuse with
non-numeric arguments, such as the non-bug report <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14207">PR#14207</a>.
</p>
<p>
</li>
<li><code>pchisq(ncp =, log.p = TRUE)</code> is more accurate for
probabilities near one.  E.g. <code>pchisq(80, 4, ncp=1,
       log.p=TRUE)</code>.  (Maybe what was meant in <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14216">PR#14216</a>.)
</p>
<p>
</li>
<li><code>maintainer()</code> has been added, to give convenient
access to the name of the maintainer of a package (contributed by
David Scott).
</p>
<p>
</li>
<li><code>sample()</code> and <code>sample.int()</code> allow zero items to
be sampled from a zero-length input.  <code>sample.int()</code> gains a
default value <code>size=n</code> to be more similar to
<code>sample()</code>.
</p>
<p>
</li>
<li><code>switch()</code> returned <code>NULL</code> on error (not
previously documented on the help page): it now does so
invisibly, analogously to if-without-else.
</p>
<p>
It is now primitive: this means that argument <code>EXPR</code> is
always matched to the first argument and there is no danger of
partial matching to later named arguments.
</p>
<p>
</li>
<li>Primitive functions <code>UseMethod()</code>, <code>attr()</code>,
<code>attr&lt;-()</code>, <code>on.exit()</code>, <code>retracemem()</code> and
<code>substitute()</code> now use standard argument matching (rather
than positional matching).  This means that all multi-argument
primitives which are not internal now use standard argument
matching except where positional matching is desirable (as for
<code>switch()</code>, <code>call()</code>, <code>.C()</code> ...).
</p>
<p>
</li>
<li>All the one-argument primitives now check that any name
supplied for their first argument is a partial match to the
argument name as documented on the help page: this also
applies to replacement functions of two arguments.
</p>
<p>
</li>
<li><code>base::which()</code> uses a new <code>.Internal</code> function
when <code>arr.ind</code> is <code>FALSE</code> resulting in a 10x speedup.
Thanks to Patrick Aboyoun for implementation suggestions.
</p>
<p>
</li>
<li>Help conversion to text now uses the first part of
<span class="samp">\enc{}{}</span> markup if it is representable in the current
output encoding.  On the other hand, conversion to LaTeX with the
default <code>outputEncoding = "ASCII"</code> uses the second part.
</p>
<p>
</li>
<li>A new class <code>"listOfMethods"</code> has been introduced to
represent the methods in a methods table, to replace the
deprecated class <code>"MethodsList"</code>.
</p>
<p>
</li>
<li><code>any()</code> and <code>all()</code> return early if possible.
This may speed up operations on long vectors.
</p>
<p>
</li>
<li><code>strptime()</code> now accepts <code>"%z"</code> (for the offset
from UTC in the RFC822 format of <code>+/-hhmm</code>).
</p>
<p>
</li>
<li>The PCRE library has been updated to version 8.02, a bug-fix
release which also updates tables to Unicode 5.02.
</p>
<p>
</li>
<li>Functions which may use a graphical <code>select.list()</code>
(including <code>menu()</code> and <code>install.packages()</code>) now check
on a Unix-alike that Tk can be started (and not just
<code>capabilities("tcltk") &amp;&amp; capabilities("X11")</code>).
</p>
<p>
</li>
<li>The parser no longer marks strings containing octal or hex
escapes as being in UTF-8 when entered in a UTF-8 locale.
</p>
<p>
</li>
<li>On platforms with cairo but not Pango (notably Mac OS X) the
initial default <code>X11()</code> type is set to <code>"Xlib"</code>: this avoids
several problems with font selection when done by cairo rather
than Pango (at least on Mac OS X).
</p>
<p>
</li>
<li>New function <code>arrayInd()</code> such that <code>which(x,
       arr.ind = TRUE)</code> for an array 'x' is now equivalent to
<code>arrayInd(which(x), dim(x), dimnames(x))</code>.
</ul>

</p>



<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> Bundles of packages are defunct.
</p>
<p>
</li>
<li><code>stats::clearNames()</code> is defunct: use <code>unname()</code>.
</p>
<p>
</li>
<li>Basic regular expressions are defunct, and
<code>strsplit()</code>, <code>grep()</code>, <code>grepl()</code>, <code>sub()</code>,
<code>gsub()</code>, <code>regexpr()</code> and <code>gregexpr()</code> no longer
have an <code>extended</code> argument.
</p>
<p>
</li>
<li><code>methods::trySilent()</code> is defunct.
</p>
<p>
</li>
<li><code>index.search()</code> (which was deprecated in 2.10.0) is no
longer exported and has a different argument list.
</p>
<p>
</li>
<li>Use of multiple arguments to <code>return()</code> is now defunct.
</p>
<p>
</li>
<li>The use of <code>UseMethod()</code> with more than two arguments
is now defunct.
</p>
<p>
</li>
<li>In the <span class="pkg">methods</span> package, the <code>"MethodsList"</code>
metadata objects which had been superseded by hash tables
(environments) since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.8.0 are being phased out.  Objects of
this class are no longer assigned or used as metadata by the
package.
</p>
<p>
<code>getMethods()</code> is now deprecated, with its internal use replaced
by <code>findMethods()</code> and other changes.  Creating objects from the
<code>"MethodsList"</code> class is also deprecated.
</p>
<p>
</li>
<li>Parsing strings containing both octal/hex and Unicode escapes
now gives a warning and will become an error in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.12.0.
</ul>

</p>



<h4>INSTALLATION</h4>

<p>

<ul>
<li> UTF-8 is now used for the reference manual and package
manuals.  This requires LaTeX &lsquo;2005/12/01&rsquo; or later.
</p>
<p>
</li>
<li><CODE>configure</CODE> looks for a POSIX compliant
<CODE>tr</CODE>, Solaris's <CODE>/usr/ucb/tr</CODE> having been found
to cause <CODE>Rdiff</CODE> to malfunction.
</p>
<p>
</li>
<li><CODE>configure</CODE> is now generated with <CODE>autoconf
       2.65</CODE>, which works better on recent systems and on Mac OS X.
</ul>

</p>



<h4>PACKAGE INSTALLATION</h4>

<p>

<ul>
<li> Characters in <font face="Courier New,Courier" color="#666666"><b>R</b></font> source which are not translatable to the
current locale are now handled more tolerantly:  these will be
converted to hex codes with a warning.  Such characters are
only really portable if they appear in comments.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> now tests that the installed package
can be loaded (and backs out the installation if it cannot): this
can be suppressed by <span class="option">--no-test-load</span>.  This avoids
installing/updating a package that cannot be used: common causes
of failures to load are missing/incompatible external software
and missing/broken dependent packages.
</p>
<p>
</li>
<li>Package installation on Windows for a package with a
&lsquo;<span class="file">src</span>&rsquo; directory now checks if a DLL is created unless there
is a &lsquo;<span class="file">src/Makefile.win</span>&rsquo; file: this helps catch broken
installations where the toolchain has not reported problems in
building the DLL.  (Note: this can be any DLL, not just one named
&lsquo;<span class="file">&lt;pkg-name&gt;.dll</span>&rsquo;.)
</ul>

</p>



<h4>BUG FIXES</h4>

<p>

</p>
<p>
<ul>
<li> Using <code>with()</code>, <code>eval()</code> etc with a list with some
unnamed elements now works.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14035">PR#14035</a>)
</p>
<p>
</li>
<li>The <code>"quick"</code> dispatch of S4 methods for primitive
functions was not happening, forcing a search each time.
(Dispatch for closures was not affected.)  A side effect is that
default values for arguments in a method that do not have
defaults in the generic will now be ignored.
</p>
<p>
</li>
<li>Trying to dispatch S4 methods for primitives during the search
for inherited methods slows that search down and potentially
could cause an infinite recursion.  An internal switch was
added to turn off all such methods from
<code>findInheritedMethods()</code>.
</p>
<p>
</li>
<li><font face="Courier New,Courier" color="#666666"><b>R</b></font> framework installation (on Mac OS X) would not work
properly if a rogue <code>Resources</code> directory was present at the
top level.  Such a non-symlink will now be renamed to
<code>Resources.old</code> (and anything previously named
<code>Resources.old</code> removed) as part of the framework
installation process.
</p>
<p>
</li>
<li>The checks for conforming S4 method arguments could fail
when the signature of the generic function omitted some of the
formal arguments (in addition to <code>...</code>).  Arguments omitted
from the method definition but conforming (per the documentation)
should now be ignored (treated as <code>"ANY"</code>) in dispatching.
</p>
<p>
</li>
<li>The computations for S4 method evaluation when <code>...</code>
was in the signature could fail, treating <code>...</code> as an
ordinary symbol.  This has been fixed, for the known cases.
</p>
<p>
</li>
<li>Various <code>ar()</code> fitting methods have more protection for
singular fits.
</p>
<p>
</li>
<li><code>callNextMethod</code> now works again with the <code>drop=</code>
argument in <span class="samp">[</span>
</p>
<p>
</li>
<li><code>parse()</code> and <code>parse_Rd()</code> miscounted columns when
multibyte UTF-8 characters were present.
</p>
<p>
</li>
<li>Formatting of help pages has had minor improvements: extra
blank lines have been removed from the text format, and empty
package labels removed from HTML.
</p>
<p>
</li>
<li><code>cor(A, B)</code> where <code>A</code> is <i>n x 1</i>
and <code>B</code> a 1-dimensional array segfaulted or gave an internal
error.  (The case <code>cor(B, A)</code> was
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=7116">PR#7116</a>.)
</p>
<p>
</li>
<li><code>cut.POSIXt()</code> applied to a start value after the DST
transition on a DST-change day could give the wrong time for
argument <code>breaks</code> in units of days or longer.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14208">PR#14208</a>)
</p>
<p>
</li>
<li><code>do_par()</code> <code>UNPROTECT</code>ed too early  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14214">PR#14214</a>)
</p>
<p>
</li>
<li>Subassignment <code>x[[....]] &lt;- y</code> didn't check for a
zero-length right hand side, and inserted a rubbish
value.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14217">PR#14217</a>)
</p>
<p>
</li>
<li><code>fisher.test()</code> no longer gives a P-value <STRONG>very</STRONG>
slightly &gt; 1, in some borderline cases.
</p>
<p>
</li>
<li>Internal function <code>matchArgs()</code> no longer modifies the
general purpose bits of the <code>SEXP</code>s that make up the formals
list of <font face="Courier New,Courier" color="#666666"><b>R</b></font> functions.  This fixes an invalid error message that
would occur when a garbage collection triggered a second call to
matchArgs for the same function <EM>via</EM> a finalizer.
</p>
<p>
</li>
<li><code>gsub()</code> in 2.10.x could fail from stack overflow for
extremely long strings due to temporary data being allocated on
the stack.  Also, <code>gsub()</code> with <code>fixed=TRUE</code> is in some
circumstances considerably faster.
</p>
<p>
</li>
<li>Several primitives, including <code>attributes()</code>,
<code>attr&lt;-()</code> <code>interactive()</code>, <code>nargs()</code> and
<code>proc.time()</code>, did not check that they were called with the
correct number of arguments.
</p>
<p>
</li>
<li>A potential race condition in <code>list.files()</code> when other
processes are operating on the directory has been fixed; the code
now dynamically allocates memory for file listings in a single
pass instead of making an initial count pass.
</p>
<p>
</li>
<li><code>mean(x, trim=, na.rm = FALSE)</code> failed to return <code>NA</code> if
<code>x</code> contained missing values.  (Reported by Bill Dunlap.)
</p>
<p>
</li>
<li>Extreme tail behavior of, <code>pbeta()</code> {and hence
<code>pf()</code>}, e.g., <code>pbeta(x, 3, 2200, lower.tail=FALSE,
       log.p=TRUE)</code> now returns finite values instead of jumping to
<code>-Inf</code> too early.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14230">PR#14230</a>).
</p>
<p>
</li>
<li><code>parse(text=x)</code> misbehaved for objects <code>x</code> that
were not coerced internally to character, notably symbols.
(Reported to R-devel by Bill Dunlap.)
</p>
<p>
</li>
<li>The internal C function <code>coerceSymbol</code> now handles
coercion to character, and warns if coercion fails (rather than
silently returning <code>NULL</code>).  This allows a name to be given
where a character vector is required in functions which coerce
internally.
</p>
<p>
</li>
<li>The interpretation by <code>strptime()</code> of <code>"%c"</code> was
non-standard (not that it is ever advisable to use locale- and
system-specific input formats).
</p>
<p>
</li>
<li>capabilities(<code>"X11"</code>) now works the same way on Mac OS X as on
other platforms (and as documented: it was always true for R
built with <span class="option">--with-aqua</span>, as the CRAN builds are).
</p>
<p>
</li>
<li>The <code>X11()</code> device with cairo but not Pango (notably Mac OS X)
now checks validity of text strings in UTF-8 locales (since
Pango does but cairo it seems does not).
</p>
<p>
</li>
<li><code>read.fwf()</code> misread multi-line records when n was specified.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14241">PR#14241</a>)
</p>
<p>
</li>
<li><code>all.equal(tolerance = e)</code> passes the numeric
tolerance also to the comparison of the attributes.
</p>
<p>
</li>
<li><code>pgamma(0, 0)</code>, a boundary case, now returns 0, its
limit from the left, rather than the limit from the right.
</p>
<p>
</li>
<li>Issuing <code>POST</code> requests to the internal web server could stall
the request under certain circumstances.
</p>
<p>
</li>
<li><code>gzcon( &lt;textConnection&gt; )</code>, an error, no longer
damages the connection (in a way to have it
segfault).  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14237">PR#14237</a>)
</p>
<p>
</li>
<li>All the results from <code>hist()</code> now use the nominal
<code>breaks</code> not those adjusted by the numeric &lsquo;fuzz&rsquo;:
in recent versions the nominal <code>breaks</code> were reported but
the 'density' referred to the intervals used in the calculation
&ndash; which mattered very slightly for one of the extreme bins.
(Based on a report by Martin Becker.)
</p>
<p>
</li>
<li>If <code>xy[z].coords</code> (used internally by many graphics
functions) are given a list as <code>x</code>, they now check that
the list has suitable names and give a more informative error
message.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13936">PR#13936</a>)
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.10.1 patched</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> The handling of line textures in the <code>postscript()</code> and
<code>pdf()</code> devices was set up for round end caps (the only type
which existed at the time): it has now been adjusted for butt
endcaps.
</p>
<p>
</li>
<li><code>lchoose(a, k)</code> is now defined as
<code>log(abs(choose(a,k)))</code>, analogously to <code>lfactorial()</code>.
</p>
<p>
</li>
<li>Although <code>\eqn{}</code> in Rd files is defined as a
&lsquo;verbatim&rsquo; macro, many packages expected <code>\dots</code> and
<code>\ldots</code> to be interpreted there (as was the case in <font face="Courier New,Courier" color="#666666"><b>R</b></font> &lt;
2.10.0), so this is now done (using an ellipsis in HTML
rendering).
</p>
<p>
</li>
<li>Escaping of braces in quoted strings in <font face="Courier New,Courier" color="#666666"><b>R</b></font>-code sections of
Rd files is allowed again.  This had been changed for the new Rd
format in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.10.0 but was only documented on the developer site
and was handled inconsistently by the converters: text and
example conversion removed the escapes but HTML conversion did
not.
</p>
<p>
</li>
<li>The PCRE library has been updated to version 8.01, a bug-fix
release.
</p>
<p>
</li>
<li><code>tools::readNEWS()</code> now accepts a digit as the first
character of a news section.
</ul>

</p>



<h4>BUG FIXES</h4>

<p>

<ul>
<li> Using <code>read.table(header=TRUE)</code> on a header with an
embedded new line would copy part of the header into the data.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14103">PR#14103</a>)
</p>
<p>
</li>
<li><code>qpois(p = 1, lambda = 0)</code> now gives 0 as for all other
<code>p</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14135">PR#14135</a>)
</p>
<p>
</li>
<li>Functions related to string comparison
(e.g. <code>unique()</code>, <code>match()</code>) could cause crashes when
used with strings not in the native encoding, e.g. UTF-8 strings
on Windows.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14114">PR#14114</a> and <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14125">PR#14125</a>)
</p>
<p>
</li>
<li><code>x[ , drop=TRUE]</code> dropped an <code>NA</code> level even if it
was in use.
</p>
<p>
</li>
<li>The dynamic HTML help system reported the wrong MIME type
for the style sheet.
</p>
<p>
</li>
<li><code>tools::codoc()</code> (used by <CODE>R CMD check</CODE>) was
missing cases where the function had no arguments but was
documented to have some.
</p>
<p>
</li>
<li>Help links containing special characters (e.g. <code>"?"</code>)
were not generated correctly when rendered in
HTML.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14155">PR#14155</a>)
</p>
<p>
</li>
<li><code>lchoose(a, k)</code> no longer wrongly gives <code>NaN</code> for
negative <code>a</code>.
</p>
<p>
</li>
<li><code>ks.test()</code> could give a p-value that was off by one
observation due to rounding error.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14145">PR#14145</a>)
</p>
<p>
</li>
<li><code>readBin()</code>/<code>readChar()</code> when reading millions of
character strings in a single call used excessive amounts of
memory (which also slowed them down).
</p>
<p>
</li>
<li><CODE>R CMD SHLIB</CODE> could fail if used with paths that
were not alphanumeric, e.g. contained <code>+</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14168">PR#14168</a>)
</p>
<p>
</li>
<li><code>sprintf()</code> was not re-entrant, which potentially
caused problems if an <code>as.character()</code> method called it.
</p>
<p>
</li>
<li>The <code>quartz()</code> device did not restore the clipping
region when filling the background for a new page.  This could be
observed in multi-page bitmap output as stale outer regions of
the plot.
</p>
<p>
</li>
<li><code>p.adjust(method, n)</code> now works correctly for the
rare case <code>n &gt; length(p)</code>, also when method differs from
<code>"bonferroni"</code> or <code>"none"</code>, thanks to a patch from
Gordon Smyth.
</p>
<p>
</li>
<li><code>tools::showNonASCII()</code> failed to detect non-ASCII characters
if <code>iconv()</code> (incorrectly) converted them to different ASCII
characters.  (Seen on Windows only.)
</p>
<p>
</li>
<li><code>tcrossprod()</code> wrongly failed in some cases when one of the
arguments was a vector and the other a matrix.
</p>
<p>
</li>
<li><code>[cr]bind(..., deparse.level=2)</code> was not always giving
names when documented to do so.  (Discovered whilst investigating
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14189">PR#14189</a>.)
</p>
<p>
</li>
<li><code>match(incomparables=&lt;non-NULL&gt;)</code> could in rare cases
infinite-loop.
</p>
<p>
</li>
<li><code>poisson.test()</code> needed to pass argument
<code>conf.level</code> to <code>binom.test()</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14195">PR#14195</a>)
</p>
<p>
</li>
<li>The <code>"nls"</code> method for <code>df.residual()</code> gave
incorrect results for models fitted with <code>na.action =
       na.exclude</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14194">PR#14194</a>)
</p>
<p>
</li>
<li>A change to <code>options(scipen=)</code> was only implemented
when printing next occurred, even though it should have affected
intervening calls to <code>axis()</code>, <code>contour()</code> and
<code>filledcontour()</code>.
</p>
<p>
</li>
<li><code>prettyNum(drop0trailing=TRUE)</code> did not handle signs of
imaginary parts of complex numbers correctly (and this was used
by <code>str()</code>: <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14201">PR#14201</a>).
</p>
<p>
</li>
<li><code>system.time()</code> had the <code>sys.child</code> component
wrong (copied <code>user.child</code> instead) on systems with
<code>HAVE_GETRUSAGE</code>.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14210">PR#14210</a>)
</p>
<p>
</li>
<li>Changing both line texture and line cap (end) resulted in the
latter to be omitted form the PDF code.  In addition, line cap
(end) and join are now set explicitly in PDF output to ensure
correct defaults.
</p>
<p>
</li>
<li>The suppression of auto-rotation in <code>bitmap()</code> and
<code>dev2bitmap()</code> with the <code>"pdfwrite"</code> device was not
working correctly.
</p>
<p>
</li>
<li><code>plot(ecdf(), log="x")</code> no longer gives an incorrect
warning.
</p>
<p>
</li>
<li><code>read.fwf()</code> works again when argument <code>file</code> is
a connection.
</p>
<p>
</li>
<li>Startup files will now be found if their paths exceed 255
bytes.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14228">PR#14228</a>)
</p>
<p>
</li>
<li><code>contrasts&lt;-</code> (in the <span class="pkg">stats</span> package) no longer has an
undeclared dependence on <span class="pkg">methods</span> (introduced in 2.10.0).
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.10.1</h3>

<p>


<h4>NEW FEATURES</h4>

<p>

<ul>
<li> The PCRE library has been updated to version 8.00.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> has new options <span class="option">--no-R</span>,
<span class="option">--no-libs</span>, <span class="option">--no-data</span>, <span class="option">--no-help</span>,
<span class="option">--no-demo</span>, <span class="option">--no-exec</span>, and <span class="option">--no-inst</span> to
suppress installation of the specified part of the package.
These are intended for special purposes (e.g. building a database
of help pages without fully installing all packages).
</p>
<p>
</li>
<li>The documented line-length limit of 4095 bytes when reading
from the console now also applies also to <code>parse(file="")</code>
(which previously had a limit of around 1024 bytes).
</p>
<p>
</li>
<li>A Bioconductor mirror can be set for use by
<code>setRepositories()</code> <EM>via</EM> the option <code>"BioC_mirror"</code>,
e.g. the European mirror can be selected by
<code>options(BioC_mirror="http://bioconductor.statistik.tu-dortmund.de")</code>.
</p>
<p>
</li>
<li>Double-clicking in a <code>tk_select.list()</code> list box now
selects the item and closes the list box (as happens on the
Windows <code>select.list()</code> widget).
</ul>

</p>



<h4>INSTALLATION</h4>

<p>

<ul>
<li> <CODE>configure</CODE> will be able to find a usable
<code>libtiff</code> in some rare circumstances where it did not
previously (where <code>libtiff</code> needed to be linked explicitly against
<code>-ljpeg</code>).
</p>
<p>
</li>
<li>Making <code>refman.pdf</code> works around a problem with the indexing
with <code>hyperref 6.79d</code> and later.
</ul>

</p>



<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> The <code>extended</code> argument is deprecated in
<code>strsplit()</code>, <code>grep()</code>, <code>grepl()</code>, <code>sub()</code>,
<code>gsub()</code>, <code>regexpr()</code> and <code>gregexpr()</code> (not just
the value <code>extended = FALSE</code>) and will be removed in <font face="Courier New,Courier" color="#666666"><b>R</b></font>
2.11.0.
</ul>

</p>



<h4>BUG FIXES</h4>

<p>

<ul>
<li> <code>trigamma(x)</code> and other <code>psigamma(x, n)</code> calls
are now accurate for very large <code>abs(x)</code>.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14020">PR#14020</a>)
</p>
<p>
</li>
<li><code>[g]sub(perl=FALSE, fixed=FALSE)</code> could use excessive
stack space when used with a very long vector containing some
non-ASCII strings.
</p>
<p>
</li>
<li>The default method of <code>weighted.mean(na.rm = TRUE)</code>
did not omit weights for <code>NA</code> observations in 2.10.0.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14032">PR#14032</a>)
</p>
<p>
</li>
<li><code>[g]regexpr(pattern, fixed = TRUE)</code> returned match
positions in bytes (not characters) in an MBCS locale if
<code>pattern</code> was a single byte.
</p>
<p>
<code>[g]sub(fixed = TRUE)</code> with a single-byte pattern could
conceivably have matched part of a multibyte character in a
non-UTF-8 MBCS.
</p>
<p>
</li>
<li><code>findLineNum()</code> and <code>setBreakpoint()</code> would
sometimes fail if the specified file was not in the current
directory.
</p>
<p>
</li>
<li>Package <span class="pkg">tcltk</span>'s <code>demo(tkdensity)</code> was broken in
2.9.0 when <code>demo()</code> was changed to set <code>par(ask = TRUE)</code>.
</p>
<p>
</li>
<li><code>gsub()</code> with backrefs could fail on extremely long strings
(hundreds of thousands of characters) due to integer overflow
in a length calculation.
</p>
<p>
</li>
<li><code>abline(untf=TRUE)</code> now uses a better x-grid in
log-scale, e.g., for <code>plot(c(1,300), c(1,300), log="xy");
	abline(4,1, untf=TRUE)</code>.
</p>
<p>
</li>
<li><code>detach()</code>/<code>unloadNamespace()</code> arrange to flush
the package's lazyload cache of <font face="Courier New,Courier" color="#666666"><b>R</b></font> objects once the
package/namespace is no longer needed.
</p>
<p>
</li>
<li>There have been small fixes to the rendering of help,
e.g. <code>\command</code> is now rendered verbatim (so e.g. <code>--</code>
is not interpreted, <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14045">PR#14045</a>).
</p>
<p>
Also, there are many small changes to help files where the new
converters were not rendering them in the same way as before.
</p>
<p>
</li>
<li><code>available.packages()</code> would fail when run on a
repository with no packages meeting the filtering conditions.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14042">PR#14042</a>)
</p>
<p>
</li>
<li><code>rep(x, times, each = 2)</code> gave invalid results when the
<code>times</code> argument was a vector longer than <code>x</code>.
Reported by Bill Dunlap.
</p>
<p>
</li>
<li>An error when <code>unloadNamespace()</code> attempted to run the
<code>.onUnload()</code> function gave an error in the reporting
function and so was not reported properly.
</p>
<p>
</li>
<li>Text help rendering did not handle very long input lines
properly.
</p>
<p>
</li>
<li><code>promptMethods()</code> generated signature documentation
improperly.
</p>
<p>
</li>
<li><code>pgamma(x, a, lower.tail=FALSE)</code> and
<code>qgamma(...)</code> are now considerably more accurate in some
regions for very small <code>a</code>.  <code>qgamma()</code> now correctly
returns <code>0</code> instead of <code>NaN</code> in similar extreme cases,
and <code>qgamma()</code> no longer warns in the case of small
<code>a</code>, see (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=12324">PR#12324</a>).
</p>
<p>
</li>
<li><code>unname()</code> now also removes names from a zero length vector.
</p>
<p>
</li>
<li>Printing results from <code>ls.str()</code> no longer evaluates
unevaluated calls.
</p>
<p>
</li>
<li><code>complete.cases()</code> failed on a 0-column data frame
argument.  (Underlies <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14066">PR#14066</a>.)
</p>
<p>
It could return nonsensical results if no input determined the
number of cases (seen in the no-segfault tests).
</p>
<p>
</li>
<li>An error in <code>nls()</code> with a long formula could cause a
segfault.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14059">PR#14059</a>)
</p>
<p>
</li>
<li><code>qchisq(p, df, ncp, lower.tail = FALSE)</code> with
<code>ncp &gt;= 80</code> was inaccurate for small <code>p</code> (as the help page
said): it is now less inaccurate.  (In part,
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13999">PR#13999</a>.)
</p>
<p>
For <code>ncp</code> less than but close to 80, <code>pchisq()</code> and
<code>qchisq()</code> are more accurate for probablilities very close
to 1 (a series expansion was truncated slightly too early).
</p>
<p>
<code>pchisq(x, df, ncp)</code> can no longer return values just larger
than one for large values of <code>ncp</code>.
</p>
<p>
</li>
<li><code>intToUtf8()</code> could fail when asked to produce 10Mb or more
strings, something it was never intended to do: unfortunately
Windows crashed <font face="Courier New,Courier" color="#666666"><b>R</b></font> (other OSes reported a lack of resources).
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14068">PR#14068</a>)
</p>
<p>
</li>
<li><code>chisq.test()</code> could fail when given argument
<code>x</code> or <code>y</code> which deparsed to more than one line.
(Reported by Laurent Gauthier.)
</p>
<p>
</li>
<li>S4 methods are uncached whenever the name space containing
them is unloaded (by <code>unloadNamespace()</code> as well as by
<code>detach(unload = TRUE))</code>.
</p>
<p>
</li>
<li>The internal record-keeping by
<code>dyn.load</code>/<code>dyn.unload</code> was incomplete, which could
crash <font face="Courier New,Courier" color="#666666"><b>R</b></font> if a DLL that registered <code>.External</code> routines had
earlier been unloaded.
</p>
<p>
</li>
<li><code>bessel[JY](x, nu)</code> with <code>nu</code> a negative integer (a
singular case) is now correct, analogously to <code>besselI()</code>,
see <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13556">PR#13556</a>.
</p>
<p>
</li>
<li><code>tools::file_path_as_absolute()</code> doubled the file
separator when applied to a file such as &lsquo;<span class="file">"/vmunix"</span>&rsquo; or (on
Windows) &lsquo;<span class="file">"d:/afile"</span>&rsquo; in a directory for which
<code>getwd()</code> would return a path with a trailing separator
(largely cosmetic, as reasonable file systems handle such a path
correctly).  (Perhaps what was meant by <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14078">PR#14078</a>.)
</p>
<p>
</li>
<li><code>unsplit(drop = TRUE)</code> applied to a data frame failed
to pass <code>drop</code> to the computation of row names.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14084">PR#14084</a>)
</p>
<p>
</li>
<li>The <code>"difftime"</code> method of <code>mean()</code> ignored its
<code>na.rm</code> argument.
</p>
<p>
</li>
<li><code>tcltk::tk_select.list()</code> is now more likely to remove the
widget immediately after selection is complete.
</p>
<p>
</li>
<li>Adding/subtracting a <code>"difftime"</code> object to/from a
<code>"POSIXt"</code> or <code>"Date"</code> object works again (it was
broken by the addition of <code>Ops.difftime</code>).
</p>
<p>
</li>
<li>Conversion to latex of an Rd file with no aliases failed.
</p>
<p>
</li>
<li><code>wilcox.test(conf.int=TRUE)</code> has achieved.level
corrected and, for <code>exact=FALSE</code>, now returns a
<code>estimate</code> component which does not depend on the
alternative used.
</p>
<p>
</li>
<li><code>help.search()</code> failed when the package argument was
specified.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=14113">PR#14113</a>)
</p>
<p>
</li>
<li><code>switch(EXPR = "A")</code> now returns <code>NULL</code>, as does
<code>switch(1)</code> (which used to signal an error).
</ul>

</p>

</p>


<h3>CHANGES IN R VERSION 2.10.0</h3>

<p>


<h4>SIGNIFICANT USER-VISIBLE CHANGES</h4>

<p>

<ul>
<li> Package help is now converted from <code>Rd</code> by the <font face="Courier New,Courier" color="#666666"><b>R</b></font>-based
converters that were first introduced in 2.9.0.  This means
</p>
<p>

<ul>
<li> Packages that were installed by R-devel after 2009-08-09
should not be used with earlier versions of <font face="Courier New,Courier" color="#666666"><b>R</b></font>, and most
aspects of package help (including the runnable examples)
will be missing if they are so used.
</p>
<p>
</li>
<li>Text, HTML and latex help and examples for packages
installed under the new system are converted on-demand from
stored parsed Rd files.  (Conversions stored in packages
installed under <font face="Courier New,Courier" color="#666666"><b>R</b></font> &lt; 2.10.0 are used if no parsed Rd files
are found.  It is recommended that such packages be
re-installed.)
</ul>

</p>
<p>
</li>
<li>HTML help is now generated dynamically using an HTTP server
running in the <font face="Courier New,Courier" color="#666666"><b>R</b></font> process and listening on the loopback
interface.
</p>
<p>

<ul>
<li> Those worried about security implications of such
a server can disable it by setting the environment variable
<span class="env">R_DISABLE_HTTPD</span> to a non-empty value.  This disables
<code>help.start()</code> and HTML help (so text help is shown
instead).
</p>
<p>
</li>
<li>The Java/Javascript search engine has been replaced by an
HTML interface to <code>help.search()</code>.  <code>help.start()</code> no
longer has an argument <code>searchEngine</code> as it is no longer
needed.
</p>
<p>
</li>
<li>The HTML help can now locate cross-references of the form
<code>\link[pkg]{foo}</code> and <code>\link[pkg:foo]{bar}</code>
where <code>foo</code> is an alias in the package, rather than the
documented (basename of a) filename (since the documentation
has been much ignored).
</ul>

</ul>

</p>



<h4>NEW FEATURES</h4>

<p>

<ul>
<li> <code>polygon()</code>, <code>pdf()</code> and <code>postscript()</code> now
have an argument <code>fillOddEven</code> (default <code>FALSE</code>),
which controls the mode used for polygon fills of
self-intersecting shapes.
</p>
<p>
</li>
<li>New <code>debugonce()</code> function; further,
<code>getOption("deparse.max.lines")</code> is now observed when
debugging, from a code suggestion by John Brzustowski.
(<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13647">PR#13647</a>/8)
</p>
<p>
</li>
<li><code>plot()</code> methods for <code>"stepfun"</code> and hence
<code>"ecdf"</code> no longer plot points by default for <code>n &gt;= 1000</code>.
</p>
<p>
</li>
<li><code>[g]sub(perl=TRUE)</code> now also supports <code>"\E"</code>
in order to <STRONG>end</STRONG> <code>"\U"</code> and <code>"\L"</code> case changes,
thanks to a patch from Bill Dunlap.
</p>
<p>
</li>
<li><code>factor()</code>, <code>levels()&lt;-</code>, etc, now ensure that
the resulting factor levels are unique (as was always the implied
intention).  Factors with duplicated levels are still
constructible by low-level means, but are now declared illegal.
</p>
<p>
</li>
<li>New <code>print()</code> (S3) method for class <code>"function"</code>,
also used for auto-printing.  Further, <code>.Primitive</code>
functions now print and auto-print identically.  The new method
is based on code suggestions by Romain Franois.
</p>
<p>
</li>
<li>The <code>print()</code> and <code>toLatex()</code> methods for class
<code>"sessionInfo"</code> now show the locale in a nicer format and
have arguments to suppress locale information.
</p>
<p>
</li>
<li>In addition to previously only <code>round()</code>, there are
other <code>Math</code> group (S3) methods for <code>"difftime"</code>,
such as <code>floor()</code>, <code>signif()</code>, <code>abs()</code>, etc.
</p>
<p>
</li>
<li>For completeness, <code>old.packages()</code> and
<code>available.packages()</code> allow arguments <code>type</code> to be
specified (you could always specify arguments <code>available</code>
or <code>contriburl</code>).
</p>
<p>
</li>
<li><code>available.packages()</code> by default only returns
information on the latest versions of packages whose version
requirements are satisfied by the currently running <font face="Courier New,Courier" color="#666666"><b>R</b></font>.
</p>
<p>
</li>
<li><code>tools::write_PACKAGES()</code> has a new argument
<code>latestOnly</code>, which defaults to <code>TRUE</code> when only the
latest versions in the repository will be listed in the index.
</p>
<p>
</li>
<li><code>getOption()</code> has a new argument <code>default</code> that
is returned if the specified option is not set.  This simplifies
querying a value and checking whether it is <code>NULL</code> or not.
</p>
<p>
</li>
<li><code>parse()</code> now warns if the requested encoding is not supported.
</p>
<p>
</li>
<li>The <code>"table"</code> method of <code>as.data.frame()</code> gains a
<code>stringsAsFactors</code> argument to allow the classifying
factors to be returned as character vectors rather than the
default factor type.
</p>
<p>
</li>
<li>If <code>model.frame.default()</code> encounters a character
variable where <code>xlev</code> indicates a factor, it now converts
the variable to a factor (with a warning).
</p>
<p>
</li>
<li><code>curve()</code> now returns a list containing the points that
were drawn.
</p>
<p>
</li>
<li><code>spineplot()</code> now accepts <code>axes = FALSE</code>, for
consistency with other functions called by <code>plot.factor()</code>.
</p>
<p>
</li>
<li>The Kendall and Spearman methods of <code>cor.test()</code> can
optionally use continuity correction when not computing exact
p-values.  (The Kendall case is the wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13691">PR#13691</a>.)
</p>
<p>
</li>
<li><font face="Courier New,Courier" color="#666666"><b>R</b></font> now keeps track of line numbers during execution for code
sourced with <code>options(keep.source = TRUE)</code>.  The source
reference is displayed by debugging functions such as
<code>traceback()</code>, <code>browser()</code>, <code>recover()</code>, and
<code>dump.frames()</code>, and is stored as an attribute on each
element returned by <code>sys.calls()</code>.
</p>
<p>
</li>
<li>More functions now have an implicit (S4) generic definition.
</p>
<p>
</li>
<li><code>quantile.default()</code> now disallows factors (wish of
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13631">PR#13631</a>) and its help
documents what numeric-like properties its input need to have to
work correctly.
</p>
<p>
</li>
<li><code>weighted.mean()</code> is now generic and has <code>"Date"</code>,
<code>"POSIXct"</code> and <code>"POSIXlt"</code> methods.
</p>
<p>
</li>
<li>Naming subscripts (e.g. <code>x[i=1, j=2]</code>) in
<code>data.frame</code> methods for <code>[</code> and <code>[[</code> now gives a
warning.  (Names are ignored in the default method, but could
have odd semantics for other methods, and do for the data.frame
ones.)
</p>
<p>
</li>
<li><code>as.data.frame()</code> has an <code>"aovproj"</code> method.
(Wish of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13505">PR#13505</a>)
</p>
<p>
</li>
<li><code>as.character(x)</code> for numeric <code>x</code> no longer
produces strings such as <code>"0.30"</code>, i.e., with trailing
zeros.  This change also renders levels construction in
<code>factor()</code> more consistent.
</p>
<p>
</li>
<li><code>codocClasses()</code>, which checks consistency of the
documentation of S4 class slots, now does so in considerably more
cases.  The documentation of inherited slots (from superclasses)
is now optional.  This affects <CODE>R CMD check &lt;pkg&gt;</CODE> when
the package defines S4 classes.
</p>
<p>
</li>
<li><code>codoc()</code> now also checks S4 methods for code/documentation
mismatches.
</p>
<p>
</li>
<li><code>for()</code>, <code>while()</code>, and <code>repeat()</code> loops now
always return NULL as their (invisible) value.  This change was
needed to address a reference counting bug without creating
performance penalties for some common use cases.
</p>
<p>
</li>
<li>The <code>print()</code> method for <code>ls.str()</code> results now
obeys an optional <code>digits</code> argument.
</p>
<p>
</li>
<li>The <code>method</code> argument of <code>glm()</code> now allows
user-contributed methods.
</p>
<p>
</li>
<li>More general <code>reorder.default()</code> replaces functionality of
<code>reorder.factor()</code> and <code>reorder.character()</code>.
</p>
<p>
</li>
<li>The function <code>aspell()</code> has been added to provide an
interface to the <CODE>Aspell</CODE> spell-checker.
</p>
<p>
</li>
<li>Filters <code>RdTextFilter()</code> and <code>SweaveTeXFilter()</code>
have been added to the tools package to provide support for
<code>aspell()</code> or other spell checkers.
</p>
<p>
</li>
<li><code>xtabs()</code> with the new argument <code>sparse = TRUE</code>
now returns a sparse Matrix, using package <span class="pkg">Matrix</span>.
</p>
<p>
</li>
<li><code>contr.sum()</code> etc gain an argument <code>sparse</code>
which allows sparse matrices to be returned.
</p>
<p>
<code>contrasts()</code> also gains a <code>sparse</code> argument which it
passes to the actual contrast function if that has a formal
argument <code>sparse</code>.
</p>
<p>
<code>contrasts(f, .) &lt;- val</code> now also works when <code>val</code>
is a sparse Matrix.  It is planned that <code>model.matrix()</code>
will work with such factors <code>f</code> in the future.
</p>
<p>
</li>
<li><code>readNEWS()</code> will recognize a UTF-8 byte-order mark
(BOM) in the &lsquo;<span class="file">NEWS</span>&rsquo; file.  However, it is safer to use only
ASCII code there because not all editors recognize BOMs.
</p>
<p>
</li>
<li>New utility function <code>inheritedSlotNames()</code> for S4
class programming.
</p>
<p>
</li>
<li><code>tabulate()</code> now allows NAs to pass through (and be ignored).
</p>
<p>
</li>
<li>If <code>debug()</code> is called on an S3 generic function then
all methods are debugged as well.
</p>
<p>
</li>
<li>Outlier symbols drawn by <code>boxplot()</code> now obey the
<code>outlwd</code> argument.  Reported by Jurgen Kluge.
</p>
<p>
</li>
<li><code>svd(x)</code> and <code>eigen(x)</code> now behave analogously to
<code>qr(x)</code> in accepting logical matrices <code>x</code>.
</p>
<p>
</li>
<li>File &lsquo;<span class="file">NEWS</span>&rsquo; is now in UTF-8, and has a BOM (often
invisible) on the first line, and <CODE>Emacs</CODE> local variables
set for UTF-8 at the end.  <code>RShowDoc("NEWS")</code> should display
this correctly, given suitable fonts.
</p>
<p>
</li>
<li><code>terms.formula(simplify = TRUE)</code> now does not deparse
the LHS and so preserves non-standard responses such as <code>`a:
       b`</code> (requested by Sundar Dorai-Raj).
</p>
<p>
</li>
<li>New function <code>news()</code> for building and querying <font face="Courier New,Courier" color="#666666"><b>R</b></font> or
package news information.
</p>
<p>
</li>
<li><code>z^n</code> for integer <code>n</code> and complex <code>z</code> is more
accurate now if <code>|n| &lt;= 65536</code>.
</p>
<p>
</li>
<li><code>factor(NULL)</code> now returns the same as
<code>factor(character(0))</code> instead of an error, and
<code>table(NULL)</code> consequently does analogously.
</p>
<p>
</li>
<li><code>as.data.frame.vector()</code> (and its copies) is slightly faster
by avoiding a copy if there are no names (following a
suggestion of Tim Hesterberg).
</p>
<p>
</li>
<li><code>writeLines()</code>, <code>writeBin()</code> and
<code>writeChar()</code> have a new argument <code>useBytes</code>.  If
false, character strings with marked encodings are translated to
the current locale (as before) but if true they are written
byte-by-byte.
</p>
<p>
</li>
<li><code>iconv()</code> has a new argument <code>mark</code> which can be
used (by experts) to suppress the declaration of encodings.
</p>
<p>
</li>
<li>&lsquo;<span class="file">DESCRIPTION</span>&rsquo; file's <code>LinkingTo</code> specs are now
recognized as installation dependencies, and included in package
management computations.
</p>
<p>
</li>
<li>Standardized &lsquo;<span class="file">DESCRIPTION</span>&rsquo; file <code>License</code> specs
are now available for package management computations.
</p>
<p>
</li>
<li><code>"\uxxxx"</code> and <code>"\Uxxxxxxxx"</code> escapes can now be
parsed to a UTF-8 encoded string even in non-UTF-8 locales (this
has been implemented on Windows since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.7.0).  The semantics
have been changed slightly: a string containing such escapes is
always stored in UTF-8 (and hence is suitable for portably
including Unicode text in packages).
</p>
<p>
</li>
<li>New <code>as.raw()</code> method for <code>"tclObj"</code> objects (wish
of <a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13758">PR#13758</a>).
</p>
<p>
</li>
<li><code>Rd.sty</code> now makes a better job of setting email addresses,
including using a monospaced font.
</p>
<p>
</li>
<li><code>textConnection()</code> gains an <code>encoding</code> argument
to determine how input strings with marked encodings will be
handled.
</p>
<p>
</li>
<li><CODE>R CMD Rd2pdf</CODE> is available as a shortcut for
<CODE>R CMD Rd2dvi --pdf</CODE>.
</p>
<p>
</li>
<li><CODE>R CMD check</CODE> now checks links where a package is
specified (<code>\link[pkg]{file}</code> or
<code>\link[pkg:file]{topic}</code>), if the package is available.
It notes if the package is not available, as in many cases this
is an error in the link.
</p>
<p>
</li>
<li><code>identical()</code> gains three logical arguments, which
allow for even more differentiation, notably <code>-0</code> and
<code>0</code>.
</p>
<p>
</li>
<li><code>legend()</code> now can specify the <code>border</code> color of
filled boxes, thanks to a patch from Frederic Schutz.
</p>
<p>
</li>
<li>Indexing with a vector index to <code>[[ ]]</code> has now been
extended to all recursive types.
</p>
<p>
</li>
<li>Pairlists may now be assigned as elements of lists.  (Lists
could always be created with pairlist elements, but <code>[[&lt;-</code>
didn't support assigning them.)
</p>
<p>
</li>
<li>The parser now supports C-preprocessor-like <code>#line</code>
directives, so error messages and source references may refer to
the original file rather than an intermediate one.
</p>
<p>
</li>
<li>New functions <code>findLineNum()</code> and
<code>setBreakpoint()</code> work with the source references to find
the location of source lines and set breakpoints (using
<code>trace()</code>) at those lines.
</p>
<p>
</li>
<li>Namespace importing is more careful about warning on masked
generics, thanks to a patch by Yohan Chalabi.
</p>
<p>
</li>
<li><code>detach()</code> now has an argument <code>character.only</code>
with the same meaning as for <code>library()</code> or
<code>require()</code>.
</p>
<p>
</li>
<li><code>available.packages()</code> gains a <code>filters</code>
argument for specifying the filtering operations performed on the
packages found in the repositories.  A new built-in
<code>"license/FOSS"</code> filter only retains packages for which
installation can proceed solely based on packages which can be
verified as Free or Open Source Software (FOSS) employing the
available license specifications.
</p>
<p>
</li>
<li>In registering an S3 class by a call to
<code>setOldClass()</code>, the data part (e.g., the object type)
required for the class can be included as one of the superclasses
in the Classes argument.
</p>
<p>
</li>
<li>The argument <code>f</code> to <code>showMethods()</code> can be an
expression evaluating to a generic function, allowing methods to
be shown for non-exported generics and other nonstandard cases.
</p>
<p>
</li>
<li><code>sprintf()</code> now supports <code>%o</code> for octal
conversions.
</p>
<p>
</li>
<li>New function <code>Sys.readlink()</code> for information about symbolic
links, including if a file is a symbolic link.
</p>
<p>
</li>
<li>Package <span class="pkg">tools</span> has new functions
<code>checkRdaFiles()</code> and <code>resaveRdaFiles()</code> to report on
the format of &lsquo;<span class="file">.rda</span>&rsquo;/&lsquo;<span class="file">.RData</span>&rsquo; data files, and to
re-save them in a different compressed format, including choosing
the most compact format available.
</p>
<p>
A new <CODE>INSTALL</CODE> option, <span class="option">--resave-data</span>, makes use
of this.
</p>
<p>
</li>
<li>File &lsquo;<span class="file">~/.R/config</span>&rsquo; is used in preference to
&lsquo;<span class="file">~/.Rconfig</span>&rsquo;, and these are now documented in &lsquo;R
Installation and Administration&rsquo;.
</p>
<p>
</li>
<li>Logic operations with complex numbers now work, as they were always
documented to, and as in S.
</p>
<p>
</li>
<li><code>arrows()</code> and <code>segments()</code> allow one of <code>x1</code>
or <code>y1</code> to be omitted to simplify the specification of
vertical or horizontal lines (suggestion of Tim Hesterberg).
</p>
<p>
</li>
<li><code>approxfun()</code> is faster by avoiding repeated <code>NA</code>
checks (diagnosis and patch by Karline Soetaert &amp; Thomas
Petzoldt).
</p>
<p>
</li>
<li>There are the beginnings of a Nynorsk translation by Karl Ove
Hufthammer.
</p>
<p>
</li>
<li><code>stripchart()</code> allows <code>par</code> <code>bg</code> to be
passed in for the background colour for <code>pch = 21</code> (wish of
<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13984">PR#13984</a>).
</p>
<p>
</li>
<li>New generic function <code>.DollarNames()</code> to enable class authors
to customize completion after the <code>$</code> extractor.
</p>
<p>
</li>
<li><code>load()</code>, <code>save()</code>, <code>dput()</code> and
<code>dump()</code> now open a not-yet-open connection in the
appropriate mode (as other functions using connections directly
already did).
</ul>

</p>



<h4>REGULAR EXPRESSIONS</h4>

<p>

<ul>
<li> A different regular expression engine is used for basic and
extended regexps and is also for approximate matching.  This is
based on the TRE library of Ville Laurikari, a modified copy of
which is included in the <font face="Courier New,Courier" color="#666666"><b>R</b></font> sources.
</p>
<p>
This is often faster, especially in a MBCS locale.
</p>
<p>
Some known differences are that it is less tolerant of invalid
inputs in MBCS locales, and in its interpretation of undefined
(extended) regexps such as <code>"^*"</code>.  Also, the interpretation of
ranges such as <code>[W-z]</code> in caseless matching is no longer to map
the range to lower case.
</p>
<p>
This engine may in future be used in &lsquo;literal&rsquo; mode for
<code>fixed = TRUE</code>, and there is a compile-time option in
<code>src/main/grep.c</code> to do so.
</p>
<p>
</li>
<li>The use of repeated boundary regexps in <code>gsub()</code> and
<code>gregexpr()</code> as warned about in the help page does not work
in this engine (it did in the previous one since 2005).
</p>
<p>
</li>
<li>Extended (and basic) regexps now support same set of options
as for <code>fixed = TRUE</code> and <code>perl = TRUE</code>, including
<code>useBytes</code> and support for UTF-8-encoded strings in
non-UTF-8 locales.
</p>
<p>
</li>
<li><code>agrep()</code> now has full support for MBCS locales with a modest
speed penalty.  This enables <code>help.search()</code> to use approximate
matching character-wise rather than byte-wise.
</p>
<p>
</li>
<li><code>[g]sub</code> use a single-pass algorithm instead of
matching twice and so is usually faster.
</p>
<p>
</li>
<li>The <code>perl = TRUE</code> versions now work correctly in a
non-UTF-8 MBCS locale, by translating the inputs to UTF-8.
</p>
<p>
</li>
<li><code>useBytes = TRUE</code> now inhibits the translation of inputs with
marked encodings.
</p>
<p>
</li>
<li><code>strsplit()</code> gains a <code>useBytes</code> argument.
</p>
<p>
</li>
<li>The algorithm used by <code>strsplit()</code> has been reordered
to batch by elements of <code>split</code>: this can be much faster for
<code>fixed = FALSE</code> (as multiple compilation of regexps is avoided).
</p>
<p>
</li>
<li>The help pages, including <code>?regexp</code>, have been updated
and should be consulted for details of the new implementations.
</ul>

</p>



<h4>HELP &amp; Rd FILE CHANGES</h4>

<p>

<ul>
<li> A new dynamic HTML help system is used by default, and may be
controlled using <code>tools::startDynamicHelp()</code>.  With this enabled,
HTML help pages will be generated on request, resolving links
by searching through the current <code>.libPaths()</code>.  The user
may set options(<code>"help.ports"</code>) to control which IP port is used
by the server.
</p>
<p>
</li>
<li><code>help.start()</code> no longer sets <code>options(htmlhelp =
       TRUE)</code> (it used to on Unix but not on Windows).  Nor does it on
Unix reset the <code>"browser"</code> option if given an argument of
that name.
</p>
<p>
Arguments <code>update</code> and <code>remote</code> are now available
on all platforms: the default is <code>update = FALSE</code> since the
http server will update the package index at first use.
</p>
<p>
</li>
<li><code>help()</code> has a new argument <code>help_type</code> (with
default set by the option of that name) to supersede arguments
<code>offline</code>, <code>htmlhelp</code> and <code>chmhelp</code>
(although for now they still work if <code>help_type</code> is
unset).  There is a new type, <code>"PDF"</code> to allow offline PDF
(rather than PostScript).
</p>
<p>
A function <code>offline_help_helper()</code> will be used if this exists
in the workspace or further down the search path, otherwise
the function of that name in the <span class="pkg">utils</span> name space is used.
</p>
<p>
</li>
<li>Plain text help is now used as the fallback for HTML help (as
it always was for Compiled HTML help on Windows).
</p>
<p>
</li>
<li>It is possible to ask for static HTML pages to be prebuilt
<EM>via</EM> the configure option <span class="option">--enable-prebuilt-html</span>.  This
may be useful for those who wish to make HTML help available
outside R, e.g. on a local web site.
</p>
<p>
</li>
<li>An experimental tag <code>\Sexpr</code> has been added to Rd
files, to evaluate expressions at build, install, or render time.
Currently install time and render time evaluation are supported.
</p>
<p>
</li>
<li>Tags <code>\if</code>, <code>\ifelse</code> and <code>\out</code> have been
added to allow format-specific (or more general, using
<code>\Sexpr</code>) conditional text in man pages.
</p>
<p>
</li>
<li>The <code>parse_Rd()</code> parser has been made more tolerant of coding
errors in Rd files:  now all syntax errors are reported as
warnings, and an attempt is made to continue parsing.
</p>
<p>
</li>
<li><code>parse_Rd()</code> now has an argument <code>fragment</code>
(default <code>FALSE</code>) to accept small fragments of Rd files (so
that <code>\Sexpr</code> can output Rd code which is then parsed).
</p>
<p>
</li>
<li><code>parse_Rd()</code> now always converts its input to UTF-8.
The <code>Rd2*</code> rendering functions have a new argument,
<code>outputEncoding</code>, which controls how their output is
encoded.
</p>
<p>
</li>
<li><code>parse_Rd()</code> no longer includes the newline as part of
a <code>"%"</code>-style comment.
</p>
<p>
</li>
<li>There have been various bug fixes and code reorganization in
the Rd renderers <code>Rd2HTML</code>, <code>Rd2latex</code>, <code>Rd2txt</code>,
and <code>Rd2ex</code>.
</p>
<p>
All example files are now created with either ASCII or UTF-8
encoding, and the encoding is only marked in the file if there
is any non-UTF-8 code (previously it was marked if the help
file had non-ASCII contents, possibly in other sections).
</p>
<p>
</li>
<li><code>print.Rd()</code> now adds necessary escape characters so that
printing and re-parsing an Rd object should produce an
equivalent object.
</p>
<p>
</li>
<li><code>parse_Rd()</code> was incorrectly handling multiple backslashes in
<font face="Courier New,Courier" color="#666666"><b>R</b></font> code strings, converting 4n+3 backslashes to 2n+1 instead
of 2n+2.
</p>
<p>
</li>
<li><code>parse_Rd()</code> now recognizes the <code>\var</code> tag within
a quoted string in <font face="Courier New,Courier" color="#666666"><b>R</b></font>-like text.
</p>
<p>
</li>
<li><code>parse_Rd()</code> now treats the argument of
<code>\command</code> as LaTeX-like, rather than verbatim.
</ul>

</p>



<h4>COMPRESSION</h4>

<p>

<ul>
<li> New function <code>untar()</code> to list or unpack tar archives,
possibly compressed.  This uses either an external <CODE>tar</CODE>
command or an internal implementation.
</p>
<p>
</li>
<li>New function <code>tar()</code> to create (possibly compressed)
tar archives.
</p>
<p>
</li>
<li>New functions <code>memCompress()</code> and
<code>memDecompress()</code> for in-memory compression and
decompression.
</p>
<p>
</li>
<li><code>bzfile()</code> has a <code>compress</code> argument to select
the amount of effort put into compression when writing.
</p>
<p>
</li>
<li>New function <code>xzfile()</code> for use with
<CODE>xz</CODE>-compressed files.  (This can also read files
compressed by some versions of <CODE>lzma</CODE>.)
</p>
<p>
</li>
<li><code>gzfile()</code> looks at the file header and so can now also
read <CODE>bzip2</CODE>-ed files and <CODE>xz</CODE>-compressed files.
</p>
<p>
</li>
<li>There are the new options of <code>save(compress = "bzip2")</code>
and <code>"xz"</code> to use <CODE>bzip2</CODE> or <CODE>xz</CODE>
compression (which will be slower, but can give substantially
smaller files).  Argument <code>compression_level</code> gives finer
control over the space/time tradeoffs.
</p>
<p>
<code>load()</code> can read such saves (but only as from this version of <font face="Courier New,Courier" color="#666666"><b>R</b></font>).
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE>/<CODE>check</CODE> and
<code>tools::writePACKAGES</code> accept a wider range of compressed
tar archives.  Precisely how wide depends on the capabilities of
the host system's <CODE>tar</CODE> command: they almost always
include <CODE>.tar.bz2</CODE> archives, and with modern versions of
<CODE>tar</CODE> other forms of compression such as <CODE>lzma</CODE>
and <CODE>xz</CODE>, and arbitrary extensions.
</p>
<p>
</li>
<li><CODE>R CMD INSTALL</CODE> has a new option
<span class="option">--data-compress</span> to control the compression used when
lazy-loading data.  New possibilities are
<span class="option">--data-compress=bzip2</span> which will give ca 15% better
compression at the expense of slower installation times, and
<span class="option">--data-compress=xz</span>, often giving even better compression
on large datasets at the expense of much longer installation
times.  (The latter is used for the recommended packages: it is
particularly effective for <span class="pkg">survival</span>.)
</p>
<p>
</li>
<li><code>file()</code> for open = <code>""</code>, <code>"r"</code> or
<code>"rt"</code> will automagically detect compressed files (from
<CODE>gzip</CODE>, <CODE>bzip2</CODE> or <CODE>xz</CODE>).  This means
that compressed files can be specified by file name (rather than
<EM>via</EM> a <code>gzfile()</code> connection) to <code>read.table()</code>,
<code>readlines()</code>, <code>scan()</code> and so on.
</p>
<p>
</li>
<li><code>data()</code> can handle compressed text files with extensions
&lsquo;<span class="file">.{txt,tab,csv}.{gz,bz2,xz}</span>&rsquo; .
</ul>

</p>



<h4>DEPRECATED &amp; DEFUNCT</h4>

<p>

<ul>
<li> <code>png(type="cairo1")</code> is defunct: the value is no longer
recognized.
</p>
<p>
</li>
<li><code>tools::Rd_parse()</code> is defunct (as this version of <font face="Courier New,Courier" color="#666666"><b>R</b></font>
uses only Rd version 2).
</p>
<p>
</li>
<li>Use of file &lsquo;<span class="file">~/.Rconf</span>&rsquo; (which was deprecated in favour
of &lsquo;<span class="file">~/.Rconfig</span>&rsquo; in 2004) has finally been removed.
</p>
<p>
</li>
<li>Bundles of packages are deprecated.  See &lsquo;Writing R
Extensions&rsquo; for the steps needed to unbundle a bundle.
</p>
<p>
</li>
<li><code>help()</code> arguments <code>offline</code>, <code>htmlhelp</code> and
<code>chmhelp</code> are deprecated in favour of <code>help_type</code>.
</p>
<p>
</li>
<li><code>clearNames()</code> (in package <span class="pkg">stats</span>) is deprecated
for <code>unname()</code>.
</p>
<p>
</li>
<li>Basic regular expressions (<code>extended = FALSE</code>) are
deprecated in <code>strsplit</code>, <code>grep</code> and friends.  There is
a precise POSIX standard for them, but it is not what recent RE
engines implement, and it seems that in almost all cases package
authors intended <code>fixed = TRUE</code> when using <code>extended =
       FALSE</code>.
</p>
<p>
</li>
<li><code>methods::trySilent()</code> is deprecated in favour of
<code>try(silent=TRUE)</code> or &ndash; more efficiently and flexibly &ndash;
something like <code>tryCatch(error = function(e) e)</code>.
</p>
<p>
</li>
<li><code>index.search()</code> is deprecated: there are no longer
directories of types other than <code>help</code>.
</ul>

</p>



<h4>INSTALLATION</h4>

<p>

<ul>
<li> cairo &gt;= 1.2 is now required (1.2.0 was released in July 2006)
for cairo-based graphics devices (which remain optional).
</p>
<p>
</li>
<li>A suitable <code>iconv()</code> is now required: support for
configure option <span class="option">--without-iconv</span> has been withdrawn (it
was deprecated in <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.5.0).
</p>
<p>
</li>
<li>Perl is no longer &lsquo;essential&rsquo;.  <font face="Courier New,Courier" color="#666666"><b>R</b></font> can be built
without it, but scripts <CODE>R CMD build</CODE>, <CODE>check</CODE>,
<CODE>Rprof</CODE> and <CODE>Sd2d</CODE> currently require it.
</p>
<p>
</li>
<li>A system <CODE>glob</CODE> function is now essential (a working
<code>Sys.glob()</code> has been assumed since <font face="Courier New,Courier" color="#666666"><b>R</b></font> 2.9.0 at least).
</p>
<p>
</li>
<li>C99 support for MBCS is now required, and configure option
<span class="option">--disable-mbcs</span> has been withdrawn.
</p>
<p>
</li>
<li>Having a version of <CODE>tar</CODE> capable of automagically
detecting compressed archives is useful for
<code>utils::untar()</code>, and so <CODE>gtar</CODE> (a common name for
GNU <CODE>tar</CODE>) is preferred to <CODE>tar</CODE>: set environment
variable <span class="env">TAR</span> to specify a particular <CODE>tar</CODE> command.
</ul>

</p>



<h4>INTERNATIONALIZATION</h4>

<p>

<ul>
<li> There is some makefile support for adding/updating translations
in packages: see <code>po/README</code> and &lsquo;Writing R Extensions&rsquo;.
</p>
<p>
There is support for the use of <code>dngettext</code> for C-level
translations in packages: see &lsquo;Writing R Extensions&rsquo;.
</ul>

</p>



<h4>BUG FIXES</h4>

<p>

<ul>
<li> Assigning an extra 0-length column to a data frame by
<code>DF[, "foo"] &lt;- value</code> now works in most cases (by filling
with <code>NA</code>s) or fails.  (It used to give a corrupt data
frame.)
</p>
<p>
</li>
<li><code>validObject()</code> avoids an error during evaluation in the case
of various incorrect slot definitions.
</p>
<p>
</li>
<li><code>n:m</code> now returns a result of type <code>"integer"</code> in
a few more boundary cases.
</p>
<p>
</li>
<li>The <code>zap.ind</code> argument to <code>printCoefmat()</code> did
not usually work as other code attempted to ensure that non-zero
values had a non-zero representation.
</p>
<p>
</li>
<li><code>printCoefmat()</code> formatted groups of columns together,
not just the <code>cs.ind</code> group but also the <code>zap.ind</code>
group and a residual group.  It now formats all columns except
the <code>cs.ind</code> group separately (and zaps the <code>zap.ind</code>
group column-by-column).  The main effect will be see in the
output from <code>print.anova()</code>, as this grouped SS-like columns
in the <code>zap.ind</code> group.
</p>
<p>
</li>
<li><code>R_ReplDLLinit()</code> initializes the top-level jump so
that some embedded applications on Windows no longer crash on
error.
</p>
<p>
</li>
<li><code>identical()</code> failed to take the encoding of character
strings into account, so identical byte patterns are not
necessarily identical strings, and similarly Latin-1 and UTF-8
versions of the same string differ in byte pattern.
</p>
<p>
</li>
<li><code>methods(f)</code> used to warn unnecessarily for an S4
generic <code>f</code> which had been created based on an existing S3
generic.
</p>
<p>
</li>
<li>The check for consistent ordering of superclasses was not
ignoring all conditional relations (the symptom was usually
spurious warnings for classes extending <code>"array"</code>).
</p>
<p>
</li>
<li>Trying to assign into a raw vector with an index vector
containing <code>NA</code>s could cause a segfault.  Reported by Herv
Pags.
</p>
<p>
</li>
<li><CODE>Rscript</CODE> could segfault if (by user error) its
filename argument was missing.  Reported by Martin Morgan.
</p>
<p>
</li>
<li><code>getAnywhere()</code> (and functions that use it, including argument
completion in the console) did not handle special built-in
functions.  Reported by Romain Francois.
</p>
<p>
</li>
<li><code>order()</code> was missing a <code>PROTECT()</code> call and so
could segfault when called on character data under certain (rare)
circumstances involving marked non-native encodings.
</p>
<p>
</li>
<li><code>prettyNum(z, drop0trailing=TRUE)</code> did not work
correctly when <code>z</code> was a complex vector.  Consequently,
<code>str(z, ...)</code> also did not.  (<a href="https://bugs.R-project.org/bugzilla3/show_bug.cgi?id=13985">PR#13985</a>)
</p>
<p>
</li>
<li><CODE>make distclean</CODE> removed too many files in
<code>etc/</code> if builddir = srcdir.
</p>
<p>
</li>
<li><CODE>R CMD</CODE> replaced <code>TEXINPUTS</code> rather than
appending to it (as documented and intended).
</p>
<p>
</li>
<li><code>help.start()</code> no longer fails on unix when
<code>"browser"</code> is a function.
</p>
<p>
</li>
<li><code>pbeta(x, ..., log.p = TRUE)</code> is sometimes more accurate,
e.g., for very small <code>x</code>.
</p>
<p>
</li>
<li>Unserializing a pre-2.8 workspace containing pure ASCII
character objects with a Latin-1 or UTF-8 encoding would corrupt
the <code>CHARSXP</code> cache.
</ul>

</p>

</p>


</body></html>
